[
    {
        "id": "69122215.9bd9fc",
        "type": "tab",
        "label": "SNIPS V3.0",
        "disabled": false,
        "info": ""
    },
    {
        "id": "401cfe4e.b70de",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 240,
        "wires": [
            [
                "107bbbcb.331074",
                "452ddbb4.bf7ed4"
            ]
        ]
    },
    {
        "id": "655386d9.785158",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "========================================================================SNIPS INTENTS INPUT=======================================================================",
        "info": "",
        "x": 2390,
        "y": 100,
        "wires": []
    },
    {
        "id": "a70d5704.dd6cf8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "endSession",
        "func": "msg.payload = {\n    \"sessionId\": msg.payload.sessionId    \n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 790,
        "y": 160,
        "wires": [
            [
                "2a97c3d2.684e4c"
            ]
        ]
    },
    {
        "id": "2a97c3d2.684e4c",
        "type": "mqtt out",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "hermes/dialogueManager/endSession",
        "qos": "",
        "retain": "",
        "broker": "4921ae70.68c63",
        "x": 1028.99995803833,
        "y": 159.9999942779541,
        "wires": []
    },
    {
        "id": "f0ade0fa.7db7f",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "250",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 630,
        "y": 160,
        "wires": [
            [
                "a70d5704.dd6cf8"
            ]
        ]
    },
    {
        "id": "7f09314a.e7f55",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "===================================================================================SNIPS CORE FUNCTIONS===================================================================================",
        "info": "",
        "x": 790,
        "y": 20,
        "wires": []
    },
    {
        "id": "c1ee229c.d37ba",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "=================================================================================HOME AUTOMATION INTENTS===================================================================================",
        "info": "",
        "x": 2420,
        "y": 20,
        "wires": []
    },
    {
        "id": "a8b2e62d.02a288",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "===================================================================CLOSE SNIPS SESSION==================================================================",
        "info": "",
        "x": 790,
        "y": 100,
        "wires": []
    },
    {
        "id": "b0b83fb4.18e6c",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "Session OUT",
        "links": [
            "107bbbcb.331074",
            "2f40d4f9.6383ec",
            "8aece76c.2442a8",
            "428511cf.105c4",
            "79c956b2.1a6d28",
            "1e8c5e32.2d35e2"
        ],
        "x": 515,
        "y": 160,
        "wires": [
            [
                "f0ade0fa.7db7f"
            ]
        ]
    },
    {
        "id": "63f59af8.9aa8e4",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://localhost:3000/rest/alexa/skill/items",
        "tls": "",
        "x": 550,
        "y": 480,
        "wires": [
            [
                "279a81ea.86ff9e"
            ]
        ]
    },
    {
        "id": "279a81ea.86ff9e",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 690,
        "y": 480,
        "wires": [
            [
                "7fd4bec0.63272"
            ]
        ]
    },
    {
        "id": "e68b6345.e2296",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "List_devices",
        "func": "flow.set(\"msgDeviceList\", msg.payload); // save for later use\nflow.set(\"msgProServIP\", msg.proServIP); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1150,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "e040fe42.c2b7b",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET ProServIP",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{payload}}}:3000/proservip",
        "tls": "",
        "x": 1200,
        "y": 400,
        "wires": [
            [
                "84323106.6f2c8"
            ]
        ]
    },
    {
        "id": "84323106.6f2c8",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "proServIP",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1390,
        "y": 400,
        "wires": [
            [
                "63f59af8.9aa8e4"
            ]
        ]
    },
    {
        "id": "bfbc3fb7.ddc99",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 280,
        "y": 300,
        "wires": [
            [
                "17c09fff.fa847",
                "6507fca2.532a94",
                "221b6100.ae88b",
                "ca52a9a8.20b058",
                "97a1b59f.39d2a8",
                "22dcafd5.473a8"
            ]
        ]
    },
    {
        "id": "e740efb9.b6b8d",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "===================================================================GET LIST OF DEVICES===================================================================",
        "info": "",
        "x": 790,
        "y": 240,
        "wires": []
    },
    {
        "id": "b7ab8dde.f7379",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 160,
        "wires": [
            [
                "18b0e9a5.f3e916"
            ]
        ]
    },
    {
        "id": "c729b92f.bebc68",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "=================================================================GET CURRENT LANGUAGE=================================================================",
        "info": "",
        "x": 790,
        "y": 940,
        "wires": []
    },
    {
        "id": "a3e58773.14ef48",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Absolute command feedback",
        "func": "if (msg.payload[0].Result === true) {\n    msg.payload = {\n        text: \"Okay\",\n        siteId: msg.cmd.siteId\n    };\n} else if (msg.current[0].Result !== false || msg.target[0].Result !== false) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Der Server hat nicht korrekt reagiert\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Le serveur n'a pas répondu correctement\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"The server did not answer correctly\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n} else {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Der Server antwortet nicht\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Le serveur ne répond pas\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"The server did not respond\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2281.000030517578,
        "y": 1894.0000886917114,
        "wires": [
            [
                "f3c37b7a.ad1518"
            ]
        ]
    },
    {
        "id": "1d00a0c7.cd834f",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 1811.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "2fe53722.d0ba88"
            ]
        ]
    },
    {
        "id": "2fe53722.d0ba88",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1981.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "bb448113.86da9"
            ]
        ]
    },
    {
        "id": "bb448113.86da9",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "8",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 2660,
        "y": 1860,
        "wires": [
            [
                "437224d4.c8771c"
            ]
        ]
    },
    {
        "id": "790fbfdb.e3776",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "======================================================================SPOKEN FEEDBACK==========================================================================",
        "info": "",
        "x": 2390,
        "y": 1800,
        "wires": []
    },
    {
        "id": "b50598ee.e88898",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "ERROR OUT",
        "links": [
            "a568cecd.16763",
            "1e302784.344688",
            "107efe87.051941",
            "34ef1b78.ad6c74",
            "de9d2514.ef8d38",
            "ce53f6dc.03d708",
            "f676ee98.2e9e3",
            "4e5bb705.ff10d8",
            "3fadc4ce.b39a3c",
            "40c62a0f.a10a74",
            "9cf44e2e.82f2a",
            "dc4cdc6b.6d3b3",
            "c1b01312.c2995",
            "9194089d.9a6138",
            "f2ee330.04b46d",
            "97964b61.a46138",
            "5df48663.317c88",
            "842c9e54.b23c3",
            "b391bf8f.c9503",
            "1eab532.0b46ead",
            "204353c.a04fcac",
            "bc1d75c.d11d988",
            "52569d1f.0e69b4",
            "69001fbb.9529b",
            "3693fdda.5fee72",
            "c10a1b8a.f25cf8",
            "99c6772f.c603d8",
            "ad4135.841dfec8",
            "74965f5f.fccb9",
            "81b227bb.71b548",
            "2b525da6.a5ead2",
            "1c8386fb.dff249",
            "a673cbd6.ea8e98",
            "245fd482.49989c",
            "90d47db3.aca5f",
            "a70c55dc.effe58",
            "11da80e0.36178f",
            "652ba7e3.d0d728",
            "f4408acb.881708",
            "123877e6.941818",
            "6098631e.c2f35c",
            "d892650c.b3fb08"
        ],
        "x": 1716.0000305175781,
        "y": 1854.0000886917114,
        "wires": [
            [
                "1d00a0c7.cd834f"
            ]
        ]
    },
    {
        "id": "3c80f1e1.d8e0fe",
        "type": "file in",
        "z": "69122215.9bd9fc",
        "name": "Get current langage",
        "filename": "/usr/share/snips/assistant/custom_asr/config.json",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "x": 760,
        "y": 1000,
        "wires": [
            [
                "8b0ea983.355e78"
            ]
        ]
    },
    {
        "id": "8b0ea983.355e78",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 930,
        "y": 1000,
        "wires": [
            [
                "170b5386.ee51bc"
            ]
        ]
    },
    {
        "id": "5f073e9e.d5f13",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 580,
        "y": 1000,
        "wires": [
            [
                "3c80f1e1.d8e0fe"
            ]
        ]
    },
    {
        "id": "170b5386.ee51bc",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Store_language",
        "func": "flow.set(\"msgLang\", msg.payload.language); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1080,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "de95b72d.5566a8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Store supported commands",
        "func": "/*result = msg.payload;\ntmp = [];\ntmp = result.split(' ');\ntmp = tmp[1].split('.');*/\n\nresult = msg.payload;\ntmp = result.split('.');\nmsg.version = {\n    major: tmp[0],\n    minor: tmp[1],\n    build: tmp[2]\n};\n\nflow.set(\"msgVersion\", msg.version); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 980,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "b74db2fd.ef17a",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "===============================================================GET CURRENT CORE VERSION===============================================================",
        "info": "",
        "x": 790,
        "y": 1080,
        "wires": []
    },
    {
        "id": "a92a0f82.3b531",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 560,
        "y": 1140,
        "wires": [
            [
                "dc191c1b.ef0c5"
            ]
        ]
    },
    {
        "id": "71c3e6df.d6e588",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "=======================================================================EXECUTE COMMAND========================================================================",
        "info": "",
        "x": 2411.000030517578,
        "y": 1114.0000886917114,
        "wires": []
    },
    {
        "id": "f8d51e40.8061c",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION OUT",
        "links": [
            "508fe008.41f8b",
            "c3dc35f5.c94108",
            "18b0e9a5.f3e916",
            "675be6d1.72ec88",
            "a2f8aac9.bd6fc8",
            "fd7fc068.412a9",
            "d6766e42.838c6",
            "6a427699.8d79d8",
            "f5231fab.2c42c",
            "c527a251.a31db",
            "f48ab389.27a1d",
            "9f5fe75e.467ce8",
            "60d4eb6c.4e06e4",
            "c3d0d578.9e32f8",
            "7c8314a.90f59ec",
            "c4d65001.d8d62",
            "8d37fe4.b5811",
            "86a06f86.12924",
            "1e0e1df2.1bf4b2",
            "14796e56.0d7942",
            "9597294b.e208c8",
            "71f5196a.3363c8",
            "7a26df.abd3492"
        ],
        "x": 1796.0000305175781,
        "y": 1274.0000886917114,
        "wires": [
            [
                "61d6e3d9.f8f07c",
                "cd308ff3.36adb"
            ]
        ]
    },
    {
        "id": "d51a9ab8.433288",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Prepare request",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.url = [];\n\nif (msg.cmd.type === \"heating\") {\n   \tfor (var i = 0; i < msg.items.length; i++) {\n   \t\tvar val = msg.cmd.value;\n   \t\tif (val < 18){\n\t            val = 18;\n        \t} else if (val > 28) {\n        \t    val = 28;\n\t        } else {\n    \t        val = val;\n\t        }\n   \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, val];\n   \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n   \t\t\n\t}\n} else if (msg.cmd.type === \"lights\") {\n    if (msg.cmd.value !== undefined) {\n       \tfor (var i = 0; i < msg.items.length; i++) {\n       \t\tif (msg.items[i].type === \"dimmers\" && msg.cmd.cmd !== \"off\") {\n       \t\t\tvar val = msg.cmd.value*2.55;\n       \t\t\tval = precisionRound(val, 1);\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n       \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t} \n       \t\telse if (msg.cmd.value > 0) {\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n       \t\telse {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n       \t\t}\n    \t}\n    }\n    else if (msg.cmd.cmd === \"on\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    }\n    else if (msg.cmd.cmd === \"off\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n       \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    }\n} else if (msg.cmd.type === \"blinds\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tif (msg.cmd.cmd === \"on\" && msg.cmd.value === undefined) {\n        \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n    \t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t}\n    \telse if (msg.cmd.cmd === \"off\" && msg.cmd.value === undefined) {\n        \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n    \t    msg.url[i] = \"\".concat(...msg.url[i]);\n        }\n        else if (msg.cmd.value !== undefined) {\n            if (msg.cmd.cmd === \"on\" || msg.cmd.cmd === \"set\") {\n           \t\tvar val = (100-msg.cmd.value)*2.55;\n           \t\tval = precisionRound(val, 1);\n           \t\tif (val > 255) {val=255;} else if (val < 0) {val=0;}\n           \t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n            } else if (msg.cmd.cmd === \"off\") {\n                var val = (msg.cmd.value)*2.55;\n           \t\tval = precisionRound(val, 1);\n           \t\tif (val > 255) {val=255;} else if (val < 0) {val=0;}\n           \t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n            }\n        }\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\") {\n    if (msg.cmd.cmd === \"on\" || msg.cmd.cmd === \"set\") {\n        if (msg.cmd.value !== undefined) {\n           \tfor (var i = 0; i < msg.items.length; i++) {\n           \t\tif (msg.items[i].setDimUrl !== undefined) {\n           \t\t\tvar val = msg.cmd.value*2.55;\n           \t\t\tval = precisionRound(val, 1);\n           \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n           \t\t\tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, val];\n           \t\t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t} \n           \t\telse if (msg.cmd.value > 0) {\n        \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n           \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t}\n           \t\telse {\n        \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n           \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n           \t\t}\n        \t}\n        }\n        else {\n    \t    for (var i = 0; i < msg.items.length; i++) {\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setOnUrl];\n       \t    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n        }\n    }\n    else if (msg.cmd.cmd === \"off\") {\n    \tfor (var i = 0; i < msg.items.length; i++) {\n    \t\tif (msg.items[i].setOffUrl !== undefined) {\n        \t\tmsg.url[i] = [msg.proServIP, msg.items[i].setOffUrl];\n           \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n        \t}\n    \t}\n    }\n}\n\nreturn msg; ",
        "outputs": 1,
        "noerr": 0,
        "x": 1941.0000305175781,
        "y": 1174.0000886917114,
        "wires": [
            [
                "3cf2f623.3dd51a",
                "2cc72cd4.677924"
            ]
        ]
    },
    {
        "id": "3cf2f623.3dd51a",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2091.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "2da86fcf.d9d64"
            ],
            [
                "dc4cdc6b.6d3b3"
            ]
        ]
    },
    {
        "id": "dc4cdc6b.6d3b3",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2176.000030517578,
        "y": 1194.0000886917114,
        "wires": []
    },
    {
        "id": "166769ee.9c0026",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2431.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "a0d3a936.989248"
            ]
        ]
    },
    {
        "id": "2da86fcf.d9d64",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2281.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "166769ee.9c0026"
            ]
        ]
    },
    {
        "id": "a0d3a936.989248",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2551.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "26754a6a.68d376"
            ]
        ]
    },
    {
        "id": "61d6e3d9.f8f07c",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Cmd ?",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "increase",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "decrease",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 1891.0000305175781,
        "y": 1274.0000886917114,
        "wires": [
            [
                "d51a9ab8.433288"
            ],
            [
                "d51a9ab8.433288"
            ],
            [
                "d51a9ab8.433288"
            ],
            [
                "fced6ca8.a4914"
            ],
            [
                "fced6ca8.a4914"
            ]
        ]
    },
    {
        "id": "d0c8fa23.cad7a8",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "FEEDBACK OUT",
        "links": [
            "407dead4.89b564",
            "b646be42.e2bf8",
            "fa4c6a88.657718"
        ],
        "x": 1716.0000305175781,
        "y": 1954.0000886917114,
        "wires": [
            [
                "76c5b45.2cbfe4c"
            ]
        ]
    },
    {
        "id": "78757d93.5e0424",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Type ?",
        "property": "cmd.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "heating",
                "vt": "str"
            },
            {
                "t": "neq",
                "v": "heating",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1891.0000305175781,
        "y": 1594.0000886917114,
        "wires": [
            [
                "d4a8cec1.0e2d8"
            ],
            [
                "aa8938f2.157f38"
            ]
        ]
    },
    {
        "id": "fced6ca8.a4914",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "GET Current",
        "func": "msg.url = [];\n\nif (msg.items[0].type === \"heating\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"dimmers\" || msg.cmd.type === \"blinds\") {\n    var cptok=0;\n    var cpter=0;\n    msg.itemsok=[];\n    msg.itemser=[];\n    for (var i = 0; i < msg.items.length; i++) {\n        if(msg.items[i].getCurrentUrl !== undefined && msg.items[i].setDimUrl !== undefined && msg.items[i].type !== \"lights\") {\n            msg.itemsok[cptok]=msg.items[i];\n            cptok++;\n        } else {\n            msg.itemser[cpter]=msg.items[i];\n            cpter++;\n        }\n    }\n    if (msg.itemsok[0] !== undefined) {\n        msg.items = msg.itemsok;\n        for (var i = 0; i < msg.itemsok.length; i++) {\n        \tmsg.url[i] = [msg.proServIP, msg.itemsok[i].getCurrentUrl];\n        \tmsg.url[i] = \"\".concat(...msg.url[i]);\n        }\n    }\n\n    if (msg.itemser.length > 0 && msg.itemsok.length === 0) {\n        if (msg.itemser.length > 1) {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" und \";\n                text3 = msg.itemser.length-1;\n                text4 = \" andere Geräte verstehen diesen Befehl nicht\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" et \";\n                text3 = msg.itemser.length-1;\n                text4 = \" autres appareils ne supportent pas cette commande\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" and \";\n                text3 = msg.itemser.length-1;\n                text4 = \" other devices do not support this command\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        } else {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" versteht diesen Befehl nicht\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" ne supporte pas cette commande\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" does not support this command\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2071.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "254df73f.d30688"
            ]
        ]
    },
    {
        "id": "3116f10.0f6711",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2811.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "ce3277b3.cf31f8"
            ]
        ]
    },
    {
        "id": "853004f6.13c148",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2671.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "3116f10.0f6711"
            ]
        ]
    },
    {
        "id": "b3df5e6c.490de",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "move msg.payload",
        "rules": [
            {
                "t": "set",
                "p": "target",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "current",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2231.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "38c908df.011a68"
            ]
        ]
    },
    {
        "id": "9293d549.669538",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2551.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "853004f6.13c148"
            ]
        ]
    },
    {
        "id": "8e1b6b5f.21c688",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2401.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "9293d549.669538"
            ]
        ]
    },
    {
        "id": "99e7a50b.444348",
        "type": "join",
        "z": "69122215.9bd9fc",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2071.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "b3df5e6c.490de"
            ]
        ]
    },
    {
        "id": "ce3277b3.cf31f8",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 2951.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "99e7a50b.444348"
            ]
        ]
    },
    {
        "id": "38c908df.011a68",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Prepare_request",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.url = [];\nmsg.newVal= [];\n\nif (msg.items[0].type === \"heating\" && msg.cmd.cmd === \"decrease\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target-val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n} else if (msg.items[0].type === \"heating\" && msg.cmd.cmd === \"increase\") {\n\tfor (var i = 0; i < msg.items.length; i++) {\n\t\tif (msg.cmd.value !== undefined) {\n\t\t    var val = msg.cmd.value;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t\telse {\n\t\t    var val = 2;\n\t\t    var target = msg.target[i].Data[0].Value;\n\t\t    var newVal = target+val;\n\t\t    if (newVal < 18){\n\t            newVal = 18;\n        \t} else if (newVal > 28) {\n        \t    newVal = 28;\n\t        } else {\n    \t        newVal = newVal;\n\t        }\n\t\t    msg.newVal[i] = newVal;\n\t\t    msg.url[i] = [msg.proServIP, msg.items[i].setTargetUrl, newVal];\n   \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n\t\t}\n\t}\n} else if (msg.cmd.type === \"lights\" && msg.cmd.cmd ===\"increase\") {\n    cptok = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.items[i].type === \"dimmers\") {\n    \t    if (msg.cmd.value !== undefined){\n    \t\t    var val = msg.cmd.value*2.55;\n    \t\t    val = precisionRound(val, 1);\n    \t\t    var newVal = msg.current[i].Data[0].Value+val;\n    \t\t    if (newVal > 255) {\n    \t    \t    newVal = 255;\n    \t        }\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[cptok] = \"\".concat(...msg.url[cptok]);\n    \t\t    cptok++;\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value+51;\n    \t\t    if (newVal > 255) {\n    \t    \t    newVal = 255;\n    \t        }\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[cptok] = \"\".concat(...msg.url[cptok]);\n    \t\t    cptok++;\n    \t    }\n        }\n    }\n} else if (msg.cmd.type === \"lights\" && msg.cmd.cmd ===\"decrease\") {\n    cptok = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.items[i].type === \"dimmers\") {\n       \t\tif (msg.cmd.value !== undefined) {\n       \t\t    var val = msg.cmd.value*2.55;\n       \t\t    val = precisionRound(val, 1);\n       \t\t    var newVal = msg.current[i].Data[0].Value-val;\n       \t\t    if (newVal < 0) {\n       \t\t        newVal = 0;\n       \t\t    }\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n       \t\t    msg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n       \t    \tmsg.url[cptok] = \"\".concat(...msg.url[cptok]);\n       \t    \tcptok++;\n       \t\t} else {\n                var newVal = msg.current[i].Data[0].Value-51;\n       \t\t    if (newVal < 0) {\n       \t\t        newVal = 0;\n       \t\t    }\n       \t\t\tmsg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n            \tmsg.url[cptok] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[cptok] = \"\".concat(...msg.url[cptok]);\n        \t\tcptok++;\n       \t\t}\n        }\n    }\n} else if (msg.cmd.type === \"blinds\" && msg.cmd.cmd ===\"decrease\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \t    if (msg.cmd.value !== undefined){\n    \t\t    var val = msg.cmd.value*2.55;\n    \t\t    val = precisionRound(val, 1);\n    \t\t    var newVal = msg.current[i].Data[0].Value+val;\n    \t\t    if (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value+51;\n    \t\t    if (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t\t    msg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n    \t\t    msg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    }\n} else if (msg.cmd.type === \"blinds\" && msg.cmd.cmd === \"increase\") {\n        for (var i = 0; i < msg.items.length; i++) {\n    \t    if (msg.cmd.value !== undefined) {\n    \t        var val = msg.cmd.value*2.55;\n    \t    \tval = precisionRound(val, 1);\n    \t    \tvar newVal = msg.current[i].Data[0].Value-val;\n           \t\tif (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n    \t\t    msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n    \t    \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n    \t    }\n    \t    else {\n    \t        var newVal = msg.current[i].Data[0].Value-51;\n    \t    \tif (newVal > 255) {newVal=255;} else if (newVal < 0) {newVal=0;}\n                msg.items[i].setDimUrl = msg.items[i].setDimUrl.replace(\"${intensity.byte}\", '');\n            \tmsg.url[i] = [msg.proServIP, msg.items[i].setDimUrl, newVal];\n        \t\tmsg.url[i] = \"\".concat(...msg.url[i]);\n        \t}\n        }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2431.000030517578,
        "y": 1314.0000886917114,
        "wires": [
            [
                "d786d932.9e2878",
                "6847e980.340548"
            ]
        ]
    },
    {
        "id": "76752101.a5d51",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2774.5714263916016,
        "y": 1314.0002460479736,
        "wires": [
            [
                "fe1e3ebf.dd0e4"
            ]
        ]
    },
    {
        "id": "d786d932.9e2878",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2621.7143173217773,
        "y": 1314.0001754760742,
        "wires": [
            [
                "76752101.a5d51"
            ]
        ]
    },
    {
        "id": "fe1e3ebf.dd0e4",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "50ms",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2897.4287757873535,
        "y": 1314.0002279281616,
        "wires": [
            [
                "b61529ac.7d7e58"
            ]
        ]
    },
    {
        "id": "407dead4.89b564",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "FEEDBACK IN",
        "links": [
            "d0c8fa23.cad7a8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 3036.000030517578,
        "y": 1374.0000886917114,
        "wires": []
    },
    {
        "id": "fa4c6a88.657718",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "FEEDBACK IN",
        "links": [
            "d0c8fa23.cad7a8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 3036.000030517578,
        "y": 1174.0000886917114,
        "wires": []
    },
    {
        "id": "254df73f.d30688",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2211.000030517578,
        "y": 1254.0000886917114,
        "wires": [
            [
                "8e1b6b5f.21c688"
            ],
            [
                "9194089d.9a6138"
            ]
        ]
    },
    {
        "id": "9194089d.9a6138",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2296.000030517578,
        "y": 1274.0000886917114,
        "wires": []
    },
    {
        "id": "d4a8cec1.0e2d8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "GET_Target",
        "func": "//Prepare all HTTP requests for GET Current Temp and put them in msg.url\n\nmsg.url = [];\n\nfor (var i = 0; i < msg.items.length; i++) {\n\tmsg.url[i] = [msg.proServIP, msg.items[i].getTargetUrl];\n\tmsg.url[i] = \"\".concat(...msg.url[i]);\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2071.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "e29bc4a1.e52e78",
                "fb4e88cf.d38dd8"
            ]
        ]
    },
    {
        "id": "c4875103.b2e49",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET Target",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "792fe662.6c3b18"
            ]
        ]
    },
    {
        "id": "32641a45.64b726",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2531.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "c4875103.b2e49"
            ]
        ]
    },
    {
        "id": "39f0c59e.edfa7a",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "target",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2531.000030517578,
        "y": 1594.0000886917114,
        "wires": [
            [
                "aa8938f2.157f38"
            ]
        ]
    },
    {
        "id": "8b88bd00.ad457",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2391.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "32641a45.64b726"
            ]
        ]
    },
    {
        "id": "e29bc4a1.e52e78",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2241.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "8b88bd00.ad457"
            ]
        ]
    },
    {
        "id": "ab46b385.00b67",
        "type": "join",
        "z": "69122215.9bd9fc",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1534.0000886917114,
        "wires": [
            [
                "39f0c59e.edfa7a"
            ]
        ]
    },
    {
        "id": "792fe662.6c3b18",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 2829.571388244629,
        "y": 1534.000096321106,
        "wires": [
            [
                "ab46b385.00b67"
            ]
        ]
    },
    {
        "id": "aa8938f2.157f38",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "GET_Current",
        "func": "msg.url = [];\n\nif (msg.cmd.type === \"heating\") {\n    for (var i = 0; i < msg.items.length; i++) {\n    \tmsg.url[i] = [msg.proServIP, msg.items[i].getCurrentUrl];\n    \tmsg.url[i] = \"\".concat(...msg.url[i]);\n    }\n} else if (msg.cmd.type === \"aux\" || msg.cmd.type === \"scenes\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"dimmers\" || msg.cmd.type === \"blinds\") {\n    var cptok=0;\n    var cpter=0;\n    msg.itemsok=[];\n    msg.itemser=[];\n    for (var i = 0; i < msg.items.length; i++) {\n        if(msg.items[i].getCurrentUrl !== undefined) {\n            msg.itemsok[cptok]=msg.items[i];\n            cptok++;\n        } else {\n            msg.itemser[cpter]=msg.items[i];\n            cpter++;\n        }\n    }\n    \n    if (msg.itemsok[0] !== undefined) {\n        for (var i = 0; i < msg.itemsok.length; i++) {\n        \tmsg.url[i] = [msg.proServIP, msg.itemsok[i].getCurrentUrl];\n        \tmsg.url[i] = \"\".concat(...msg.url[i]);\n        }\n    }\n    \n    if (msg.itemser.length > 0 && msg.itemsok.length === 0) {\n        if (msg.itemser.length > 1) {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" und \";\n                text3 = msg.itemser.length-1;\n                text4 = \" \";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" et \";\n                text3 = msg.itemser.length-1;\n                text4 = \" autres appareils ne supportent pas cette commande\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" and \";\n                text3 = msg.itemser.length-1;\n                text4 = \" other devices do not support this command\";\n                texttabl = [text1, text2, text3, text4];\n                var text = \"\".concat(...texttabl);            \n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        } else {\n            if (msg.cmd.lang === \"de\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" \";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else if (msg.cmd.lang === \"fr\") {\n                text1 = msg.itemser[0].name;\n                text2 = \" ne supporte pas cette commande\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            } else {\n                text1 = msg.itemser[0].name;\n                text2 = \" does not support this command\";\n                texttabl = [text1, text2];\n                var text = \"\".concat(...texttabl);\n                msg.error = {\n                    text: text,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2061.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "2ee1e09f.007d9",
                "9c57161f.202548"
            ]
        ]
    },
    {
        "id": "c92fbbf.5c06a48",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET Current",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2911.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "d7b0c1b6.2e36f"
            ]
        ]
    },
    {
        "id": "6129578f.046638",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "50",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2728.8573112487793,
        "y": 1654.0001401901245,
        "wires": [
            [
                "c92fbbf.5c06a48"
            ]
        ]
    },
    {
        "id": "5295067f.0aa408",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "payload",
                "pt": "msg",
                "to": "current",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2371.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "b646be42.e2bf8"
            ]
        ]
    },
    {
        "id": "bc437d20.4226c",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2571.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "6129578f.046638"
            ]
        ]
    },
    {
        "id": "4c088346.71163c",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "url",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2401.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "bc437d20.4226c"
            ]
        ]
    },
    {
        "id": "40bab762.a1a758",
        "type": "join",
        "z": "69122215.9bd9fc",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2191.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "5295067f.0aa408"
            ]
        ]
    },
    {
        "id": "d7b0c1b6.2e36f",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 2051.000030517578,
        "y": 1734.0000886917114,
        "wires": [
            [
                "40bab762.a1a758"
            ]
        ]
    },
    {
        "id": "b646be42.e2bf8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "FEEDBACK IN",
        "links": [
            "d0c8fa23.cad7a8",
            "fb3a84d7.87d6d8",
            "fa8fd201.bc662"
        ],
        "x": 2516.000030517578,
        "y": 1734.0000886917114,
        "wires": []
    },
    {
        "id": "2ee1e09f.007d9",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2211.000030517578,
        "y": 1654.0000886917114,
        "wires": [
            [
                "4c088346.71163c"
            ],
            [
                "f2ee330.04b46d"
            ]
        ]
    },
    {
        "id": "f2ee330.04b46d",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2296.000030517578,
        "y": 1674.0000886917114,
        "wires": []
    },
    {
        "id": "1d9c0479.88924c",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "QUERY EXECUTION OUT",
        "links": [
            "a940c273.c4976",
            "483102fe.64f09c",
            "17c7a2ae.24b62d",
            "7e44759b.48d93c"
        ],
        "x": 1796.0000305175781,
        "y": 1594.0000886917114,
        "wires": [
            [
                "78757d93.5e0424",
                "627fe20f.efe74c"
            ]
        ]
    },
    {
        "id": "26754a6a.68d376",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "Send URL",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "2e32e28d.c5298e"
            ]
        ]
    },
    {
        "id": "4e3e32ec.6083cc",
        "type": "join",
        "z": "69122215.9bd9fc",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "fa4c6a88.657718"
            ]
        ]
    },
    {
        "id": "2e32e28d.c5298e",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 2831.000030517578,
        "y": 1174.0000886917114,
        "wires": [
            [
                "4e3e32ec.6083cc"
            ]
        ]
    },
    {
        "id": "b61529ac.7d7e58",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "Send URL",
        "method": "GET",
        "ret": "txt",
        "url": "{{{payload}}}",
        "tls": "",
        "x": 2691.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "f70619c6.8b6a08"
            ]
        ]
    },
    {
        "id": "a2520275.48b8d",
        "type": "join",
        "z": "69122215.9bd9fc",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "x": 2951.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "407dead4.89b564"
            ]
        ]
    },
    {
        "id": "f70619c6.8b6a08",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": false,
        "x": 2831.000030517578,
        "y": 1374.0000886917114,
        "wires": [
            [
                "a2520275.48b8d"
            ]
        ]
    },
    {
        "id": "5270060e.f5fe48",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "========================================================================EXECUTE QUERY==========================================================================",
        "info": "",
        "x": 2411.000030517578,
        "y": 1474.0000886917114,
        "wires": []
    },
    {
        "id": "76c5b45.2cbfe4c",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Query ?",
        "property": "cmd.query",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 1821.0000305175781,
        "y": 1954.0000886917114,
        "wires": [
            [
                "3459ecc3.56dc14"
            ],
            [
                "2596123.24550ee"
            ]
        ]
    },
    {
        "id": "3459ecc3.56dc14",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "",
        "property": "cmd.cmd",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "set",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "increase",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "decrease",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 2071.000030517578,
        "y": 1914.0000886917114,
        "wires": [
            [
                "a3e58773.14ef48"
            ],
            [
                "a3e58773.14ef48"
            ],
            [
                "a3e58773.14ef48"
            ],
            [
                "4a469af3.9c2324"
            ],
            [
                "4a469af3.9c2324"
            ]
        ]
    },
    {
        "id": "4a469af3.9c2324",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Relative command feedback",
        "func": "if (msg.cmd.type === \"aux\" || msg.cmd.type === \"lights\" || msg.cmd.type === \"blinds\") {\n    if (msg.payload[0].Result === true) {\n        msg.payload = {\n            text: \"Okay\",\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n} else if (msg.cmd.type === \"heating\") {\n    msg.text = [];\n    if (msg.cmd.lang === \"fr\") {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, le thermostat est réglé sur \";\n                var text2 = \" degrés dans la zone \";\n                msg.text[i] = [text1, target, text2, room];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"de\") {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, die Heizung ist auf \";\n                var text2 = \" Grad in \";\n                var text3 = \" eingestellt\";\n                msg.text[i] = [text1, target, text2, room, text3];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else {\n        for (var i = 0; i < msg.payload.length; i++) {\n            if (msg.payload[i].Result === true) {\n                var room = msg.items[i].zone;\n                var target = msg.newVal[i];\n                var text1 = \"Okay, setting the heating to \";\n                var text2 = \" degrees in the \";\n                msg.text[i] = [text1, target, text2, room];\n                var endText = \"\".concat(...msg.text[i]);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2281.000030517578,
        "y": 1934.0000886917114,
        "wires": [
            [
                "f0036b0f.e96878"
            ]
        ]
    },
    {
        "id": "1ed73ec2.721891",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Query feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nmsg.payload = [];\nmsg.text = [];\n\nif (msg.cmd.type === \"lights\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if (msg.cmd.lang === \"fr\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est éteint\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumé\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumée à \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        } else if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist aus\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist an\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"Die Helligkeit von \";\n                    var text3 = \" ist auf \";\n                    var text4 = \" Prozent eingestellt\";\n                    msg.text[i] = [text2, text1, text3, current, text4];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        } else {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is off\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is on\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"'s luminosity is set to  \";\n                    var text3 = \" percent\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    } \n} else if (msg.cmd.type === \"heating\" && msg.current !== undefined && msg.target !== undefined) {\n    if (msg.cmd.lang === \"fr\"){\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n           \t\tvar text1 = \"Le thermostat est réglé sur \";\n                var text2 = \" dans la zone \";\n                var text3 = \" pour une température actuelle de \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"de\") {\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n           \t\tvar text1 = \"Die Heizung ist auf \";\n                var text2 = \" grad in \";\n                var text3 = \" eingestellt bei einer aktuellen Temperatur von \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else {\n        if (msg.current[0].Result === true && msg.target[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var target = msg.target[i].Data[0].Value;\n                var current = precisionRound(msg.current[i].Data[0].Value, 0);\n                var room = msg.items[i].zone;\n                var text1 = \"Heating is set to \";\n                var text2 = \" degrees in the \";\n                var text3 = \", with a current temperature of \";\n                msg.text[i] = [text1, target, text2, room, text3, current];\n           \t\tvar endText = \"\".concat(...msg.text[i]);\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n} if (msg.cmd.type === \"aux\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est éteint\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumé\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est allumée à \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        } else if (msg.cmd.lang === \"de\"){\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist aus\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist an\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \"Das Gerät \";\n                    var text3 = \"ist auf \";\n                    var text4 = \"Prozent eingestellt\";\n                    msg.text[i] = [text2, text1, text3, current, text4];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        } else {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is off\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is on\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <256){\n                    var current = precisionRound(current/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is set to  \";\n                    var text3 = \"percent\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    } \n} if (msg.cmd.type === \"blinds\" && msg.current !== undefined){\n    if (msg.cmd.lang === \"de\") {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist geöffnet\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \"ist geschlossen\"; \n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" ist auf \";\n                    var text3 = \" Prozent gestellt\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            }\n        }\n    } else if (msg.cmd.lang === \"fr\") {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est ouvert\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \"est fermé\"; \n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" est réglé sur \";\n                    var text3 = \" pourcents\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n        }\n    } else {\n        if (msg.current[0].Result === true) {\n            for (var i = 0; i < msg.items.length; i++) {\n                var current = msg.current[i].Data[0].Value;\n                if (current === false || current === 0){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is fully open\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (current === true || current === 255){\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is closed\";\n                    msg.text[i] = [text1, text2];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                if (typeof(current) !== \"boolean\" && current > 0 && current <255){\n                    var current = precisionRound((255-current)/2.55, 0);\n                    var text1 = msg.items[i].object;\n                    var text2 = \" is \";\n                    var text3 = \" percent open\";\n                    msg.text[i] = [text1, text2, current, text3];\n                    msg.text[i] = [text1, text2, current, text3];\n                    var endText = \"\".concat(...msg.text[i]);\n                }\n                msg.payload[i] = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang:\"en-EN\"\n                };\n            }\n        }\n    }\n\n\n} else if ((msg.cmd.type === \"heating\" && (msg.current === undefined || msg.target === undefined))|| \n(msg.current === undefined && msg.cmd.type !== \"heating\")) {\n    msg.error = [];\n    if (msg.current[0].Result !== false || msg.target[0].Result !== false) {\n        if (msg.cmd.lang === \"de\") {\n            msg.error = {\n                text: \"Der Server hat nicht korrekt reagiert\",\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        } else if (msg.cmd.lang === \"fr\") {\n            msg.error = {\n                text: \"Le serveur n'a pas répondu correctement\",\n                siteId: msg.cmd.siteId,\n                lang:\"fr-FR\"\n            };\n        } else {\n            msg.error = {\n                text: \"The server did not react correctly\",\n                siteId: msg.cmd.siteId,\n                lang:\"en-EN\"\n            };\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2200,
        "y": 1980,
        "wires": [
            [
                "b8109d0d.b62a2"
            ]
        ]
    },
    {
        "id": "6a8a4a0c.053c04",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:turnOnLights",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 160,
        "wires": [
            [
                "401cfe4e.b70de"
            ]
        ]
    },
    {
        "id": "7fd4bec0.63272",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "test ProServIP",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\n\nif (msg.proServIP === \"\" || msg.proServIP.search(\"ECONNREFUSED\") !== -1 || msg.proServIP === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        text = \"Bitte überprüfen Sie die adresse von ProServ\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Veuillez vérifier l'adresse du Proserv\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Please check the configuration of the ProServ address\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 840,
        "y": 480,
        "wires": [
            [
                "1367b60d.5f285a"
            ]
        ]
    },
    {
        "id": "1367b60d.5f285a",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 990,
        "y": 480,
        "wires": [
            [
                "e68b6345.e2296"
            ],
            [
                "5df48663.317c88"
            ]
        ]
    },
    {
        "id": "5df48663.317c88",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 1075,
        "y": 500,
        "wires": []
    },
    {
        "id": "f3c37b7a.ad1518",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1894.0000886917114,
        "wires": [
            [
                "bb448113.86da9"
            ],
            [
                "842c9e54.b23c3"
            ]
        ]
    },
    {
        "id": "842c9e54.b23c3",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898"
        ],
        "x": 2556.000030517578,
        "y": 1914.0000886917114,
        "wires": []
    },
    {
        "id": "f0036b0f.e96878",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1934.0000886917114,
        "wires": [
            [
                "bb448113.86da9"
            ],
            [
                "b391bf8f.c9503"
            ]
        ]
    },
    {
        "id": "b391bf8f.c9503",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898"
        ],
        "x": 2556.000030517578,
        "y": 1954.0000886917114,
        "wires": []
    },
    {
        "id": "2afdded3.b35982",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2471.000030517578,
        "y": 1974.0000886917114,
        "wires": [
            [
                "437224d4.c8771c"
            ],
            [
                "1eab532.0b46ead"
            ]
        ]
    },
    {
        "id": "1eab532.0b46ead",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898"
        ],
        "x": 2556.000030517578,
        "y": 1994.0000886917114,
        "wires": []
    },
    {
        "id": "fd2281ac.6edd",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "DEBUG OUT",
        "links": [
            "e443f6e.2335a08",
            "22c6aed9.bb0942",
            "2cc72cd4.677924",
            "fb4e88cf.d38dd8",
            "6847e980.340548",
            "9c57161f.202548",
            "cd308ff3.36adb",
            "627fe20f.efe74c",
            "7a651595.5860ac",
            "42472400.29b25c",
            "6ea14c45.3e6cf4",
            "18b0e9a5.f3e916",
            "f5231fab.2c42c",
            "c527a251.a31db",
            "f48ab389.27a1d",
            "9f5fe75e.467ce8",
            "17c7a2ae.24b62d",
            "60d4eb6c.4e06e4",
            "c3d0d578.9e32f8",
            "7c8314a.90f59ec",
            "c4d65001.d8d62",
            "8d37fe4.b5811",
            "86a06f86.12924",
            "1e0e1df2.1bf4b2",
            "14796e56.0d7942",
            "9597294b.e208c8",
            "7a26df.abd3492",
            "71f5196a.3363c8",
            "7e44759b.48d93c"
        ],
        "x": 675,
        "y": 1920,
        "wires": [
            [
                "7cea74ff.3c8b9c",
                "62464887.913428",
                "7a2cd834.32b828",
                "799a1604.004568",
                "1a608d56.ab0533",
                "f3fbca7c.b0fca8",
                "947cbd5d.69354",
                "59d56de9.50f274",
                "ce574c65.6fb5f",
                "63d714a1.e1aaac",
                "d2c42f6a.b4133",
                "785a04fd.c0fc8c",
                "b06e8470.7cbaa8",
                "a8e66cba.44ed7"
            ]
        ]
    },
    {
        "id": "ce574c65.6fb5f",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.room",
        "x": 840,
        "y": 1840,
        "wires": []
    },
    {
        "id": "63d714a1.e1aaac",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.cmd",
        "x": 840,
        "y": 1800,
        "wires": []
    },
    {
        "id": "59d56de9.50f274",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.device",
        "x": 840,
        "y": 1880,
        "wires": []
    },
    {
        "id": "947cbd5d.69354",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.value",
        "x": 840,
        "y": 1920,
        "wires": []
    },
    {
        "id": "f3fbca7c.b0fca8",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.query",
        "x": 840,
        "y": 1960,
        "wires": []
    },
    {
        "id": "d2c42f6a.b4133",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.lang",
        "x": 840,
        "y": 1760,
        "wires": []
    },
    {
        "id": "62464887.913428",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "deviceList",
        "x": 839.8571341378347,
        "y": 1720,
        "wires": []
    },
    {
        "id": "1a608d56.ab0533",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "commandList",
        "x": 850,
        "y": 2000,
        "wires": []
    },
    {
        "id": "799a1604.004568",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.type",
        "x": 840,
        "y": 2040,
        "wires": []
    },
    {
        "id": "7a2cd834.32b828",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "proServIP",
        "x": 840,
        "y": 2080,
        "wires": []
    },
    {
        "id": "7cea74ff.3c8b9c",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "cmd.all",
        "x": 830,
        "y": 1680,
        "wires": []
    },
    {
        "id": "785a04fd.c0fc8c",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "false",
        "x": 830,
        "y": 2120,
        "wires": []
    },
    {
        "id": "ffa4f3f6.295e7",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "======================================================================DEBUGGING TOOLS==================================================================",
        "info": "",
        "x": 790,
        "y": 1620,
        "wires": []
    },
    {
        "id": "d6cfb2a2.8b3d2",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "",
        "property": "items[1]",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2050,
        "y": 1980,
        "wires": [
            [
                "1ed73ec2.721891"
            ],
            [
                "8e06914f.4d82a"
            ]
        ]
    },
    {
        "id": "8e06914f.4d82a",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Query feedback",
        "func": "function precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction searchStatusDevice() {\n    msg.itemson = [];\n    msg.itemsoff = [];\n    cpton = 0;\n    cptoff = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.current[i].Data[0].Value === true || (msg.current[i].Data[0].Value > 0 && msg.current[i].Data[0].Value <256)) {\n            msg.itemson[cpton] = msg.items[i];\n            cpton++;\n        } else if (msg.current[i].Data[0].Value === false || msg.current[i].Data[0].Value === 0) {\n            msg.itemsoff[cptoff] = msg.items[i];\n            cptoff++;\n        }\n    }\n}\n\nfunction searchStatusBlinds() {\n    msg.itemson = [];\n    msg.itemsoff = [];\n    cpton = 0;\n    cptoff = 0;\n    for (var i = 0; i < msg.items.length; i++) {\n        if (msg.current[i].Data[0].Value === false || msg.current[i].Data[0].Value === 255) {\n            msg.itemsoff[cptoff] = msg.items[i];\n            cptoff++;\n        } else if (msg.current[i].Data[0].Value === true || (msg.current[i].Data[0].Value >= 0 && msg.current[i].Data[0].Value <255)) {\n            msg.itemson[cpton] = msg.items[i];\n            cpton++;\n        }\n    }\n}\n\nmsg.payload = [];\nmsg.text = [];\n\nif (msg.cmd.type === \"lights\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchStatusDevice();\n        if (msg.itemson.length > 0 && msg.itemsoff.length > 0) {\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est allumé et \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist an und \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is on and \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemson.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" andere Licht sind an und \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" autres lumières sont allumées et \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" other lights are on and \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            }\n            if (msg.itemsoff.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" est éteints\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" ist aus\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" is off\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemsoff.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" andere Licht sind aus\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" autres lumières sont éteintes\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" other lights are off\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            }\n            endTextTabl = [textTabl1, textTabl2];\n            var endText = \"\".concat(...endTextTabl);\n            if (msg.cmd.lang === \"de\") {endLang = \"de-DE\";} else if (msg.cmd.lang === \"fr\") {endLang = \"fr-FR\";} else {endLang = \"en-EN\";}\n            msg.payload = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: endLang\n            };\n        } else {\n            if (msg.itemson.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Toutes les lumières sont éteintes\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \" all lights are off\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsoff.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Toutes les lumières sont allumées\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist an\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \" all lights are on\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}\n\nif (msg.cmd.type === \"blinds\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchOnBlinds();\n        if (msg.itemson.length > 0 && msg.itemsoff.length > 0) {\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est ouvert et \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist geoeffnet und \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is opened and \";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemson.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" andere Geräte sind geöffnet und \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" autres appareils sont ouverts et \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemson[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemson.length-1;\n                    text4 = \" other devices are opened and \";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            }\n            if (msg.itemsoff.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" est fermés\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" ist geschlossen\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemsoff[0].object;\n                    var text2 = \" is closed\";\n                    textTabl = [text1, text2];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            } else if (msg.itemsoff.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" und \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" andere Geräte sind geschlossen\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else if (msg.cmd.lang === \"fr\") {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" et \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" autres appareils sont fermés\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                } else {\n                    text1 = msg.itemsoff[0].object;\n                    text2 = \" and \";\n                    text3 = msg.itemsoff.length-1;\n                    text4 = \" other devices are closed\";\n                    textTabl = [text1, text2, text3, text4];\n                    var textTabl2 = \"\".concat(...textTabl);\n                }\n            }\n            endTextTabl = [textTabl1, textTabl2];\n            var endText = \"\".concat(...endTextTabl);\n            if (msg.cmd.lang === \"de\") {endLang = \"de-DE\";} else if (msg.cmd.lang === \"fr\") {endLang = \"fr-FR\";} else {endLang = \"en-EN\";}\n            msg.payload = {\n                text: endText,\n                siteId: msg.cmd.siteId,\n                lang: endLang\n            };\n        }\n        if (msg.itemson.length === 0) {\n            if (msg.cmd.lang === \"fr\"){\n                var text1 = \" tous les volets sont fermés\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n            else if (msg.cmd.lang === \"de\"){\n                var text1 = \" alles ist geschlossen\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else {\n                var text1 = \" all shutters are off\";\n                textTabl = [text4, text1, text2];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n        if (msg.itemsoff.length === 0) {\n            if (msg.cmd.lang === \"fr\"){\n                var text1 = \" tous les volets sont ouverts\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"fr-FR\"\n                };\n            }\n            else if (msg.cmd.lang === \"de\"){\n                var text1 = \" alles ist geöffnet\";\n                textTabl = [text4, text1];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"de-DE\"\n                };\n            } else {\n                var text1 = \" all blinds are open\";\n                textTabl = [text4, text1, text2];\n                var endText = \"\".concat(...textTabl);\n                msg.payload = {\n                    text: endText,\n                    siteId: msg.cmd.siteId,\n                    lang: \"en-EN\"\n                };\n            }\n        }\n    }\n}\n\nif (msg.cmd.type === \"scenes\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        searchStatusDevice();\n            if (msg.itemson.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" est activée\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" ist an\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                } else {\n                    var text1 = msg.itemson[0].object;\n                    var text2 = \" is activated\";\n                    textTabl = [text1, text2];\n                    var textTabl1 = \"\".concat(...textTabl);\n                }\n            if (msg.itemson.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    var text1 = \"Aucune scène n'est activée\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    var text1 = \"There is no scene activated\";\n                    textTabl = [text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}\n\n/*\nif (msg.cmd.type === \"aux\" && msg.current !== undefined){\n    if (msg.current[0].Result === true) {\n        if ((msg.cmd.cmd === \"on\" && msg.cmd.room !== undefined) || (msg.cmd.cmd === \"on\" && msg.cmd.all === \"everywhere\") || (msg.cmd.cmd === \"off\" && (msg.cmd.all !== undefined || msg.cmd.room !== undefined))) {\n            searchStatusDevice();\n            if (msg.itemsok.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = \" tous les appareils sont éteints\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = \" alles ist aus\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = \" all devices are off\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsok.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" est allumé\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" ist an\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" is on\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            } if (msg.itemsok.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    if (msg.true === true) { var text5 = \"Ja, \";} else if (msg.true === false) { var text5 = \"Nein, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" und \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" andere Geräte sind an\";\n                    textTabl = [text5,text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else if (msg.cmd.lang === \"fr\") {\n                    if (msg.true === true) { var text5 = \"Oui, \";} else if (msg.true === false) { var text5 = \"Non, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" et \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" autres appareils sont allumés\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                } else {\n                    if (msg.true === true) { var text5 = \"Yes, \";} else if (msg.true === false) { var text5 = \"No, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" and \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" other devices are on\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        } else if (msg.cmd.cmd === \"on\" && msg.cmd.all === \"all\") {\n            searchStatusDevice();\n            if (msg.itemsok.length === 0) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = \" tous les appareils sont allumés\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = \" alles ist an\";\n                    textTabl = [text4, text1];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = \" all devices are on\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n            else if (msg.itemsok.length === 1) {\n                if (msg.cmd.lang === \"fr\"){\n                    if (msg.true === true) { var text4 = \"Oui, \";} else if (msg.true === false) { var text4 = \"Non, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" est éteints\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                }\n                else if (msg.cmd.lang === \"de\"){\n                    if (msg.true === true) { var text4 = \"Ja, \";} else if (msg.true === false) { var text4 = \"Nein, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" ist aus\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else {\n                    if (msg.true === true) { var text4 = \"Yes, \";} else if (msg.true === false) { var text4 = \"No, \";} else {var text4 = \"\";}\n                    var text1 = msg.itemsok[0].name;\n                    var text2 = \" is off\";\n                    textTabl = [text4, text1, text2];\n                    var endText = \"\".concat(...textTabl);\n                    msg.payload = {\n                        text: endText,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            } if (msg.itemsok.length > 1) {\n                if (msg.cmd.lang === \"de\") {\n                    if (msg.true === true) { var text5 = \"Ja, \";} else if (msg.true === false) { var text5 = \"Nein, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" und \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" andere Geräte sind auf\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"de-DE\"\n                    };\n                } else if (msg.cmd.lang === \"fr\") {\n                    if (msg.true === true) { var text5 = \"Oui, \";} else if (msg.true === false) { var text5 = \"Non, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" et \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" autres appareils sont éteints\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"fr-FR\"\n                    };\n                } else {\n                    if (msg.true === true) { var text5 = \"Yes, \";} else if (msg.true === false) { var text5 = \"No, \";} else {var text5 = \"\";}\n                    text1 = msg.itemsok[0].name;\n                    text2 = \" and \";\n                    text3 = msg.itemsok.length-1;\n                    text4 = \" other devices are off\";\n                    textTabl = [text5, text1, text2, text3, text4];\n                    var text = \"\".concat(...textTabl);            \n                    msg.payload = {\n                        text: text,\n                        siteId: msg.cmd.siteId,\n                        lang: \"en-EN\"\n                    };\n                }\n            }\n        }\n    }\n}*/\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2200,
        "y": 2020,
        "wires": [
            [
                "2afdded3.b35982"
            ]
        ]
    },
    {
        "id": "97a1b59f.39d2a8",
        "type": "trigger",
        "z": "69122215.9bd9fc",
        "op1": "",
        "op2": "",
        "op1type": "pay",
        "op2type": "pay",
        "duration": "1",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 360,
        "wires": [
            [
                "99de0a6d.888248"
            ]
        ]
    },
    {
        "id": "ca52a9a8.20b058",
        "type": "trigger",
        "z": "69122215.9bd9fc",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "2",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 380,
        "wires": [
            [
                "99de0a6d.888248"
            ]
        ]
    },
    {
        "id": "221b6100.ae88b",
        "type": "trigger",
        "z": "69122215.9bd9fc",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "3",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 400,
        "wires": [
            [
                "99de0a6d.888248"
            ]
        ]
    },
    {
        "id": "17c09fff.fa847",
        "type": "trigger",
        "z": "69122215.9bd9fc",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "4",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 420,
        "wires": [
            [
                "99de0a6d.888248"
            ]
        ]
    },
    {
        "id": "6507fca2.532a94",
        "type": "trigger",
        "z": "69122215.9bd9fc",
        "op1": "",
        "op2": "",
        "op1type": "nul",
        "op2type": "pay",
        "duration": "5",
        "extend": false,
        "units": "min",
        "reset": "",
        "name": "",
        "x": 330,
        "y": 440,
        "wires": [
            [
                "99de0a6d.888248"
            ]
        ]
    },
    {
        "id": "c3281764.1b7268",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Starting up feedback",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.serverSiteId = flow.get(\"msgServerSiteId\");\n\nif (msg.cmd.siteId === undefined) {\n    msg.cmd.siteId = msg.serverSiteId;\n}\n\nif (msg.cmd.lang === \"de\") {\n    text = \"Startet, bitte warten\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"de-DE\"\n    };\n} else if (msg.cmd.lang === \"fr\") {\n    text = \"Démarrage, veuillez patienter\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"fr-FR\"\n    };\n} else {\n    text = \"Starting up, please wait\";\n    msg.error = {\n        text: text,\n        siteId: msg.cmd.siteId,\n        lang: \"en-EN\"\n    };\n}\n\ncptok = 0;\ncpter = 0;\nflow.set(\"cptok\", cptok); // save for later use\nflow.set(\"cpter\", cpter); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 690,
        "y": 300,
        "wires": [
            [
                "bc1d75c.d11d988"
            ]
        ]
    },
    {
        "id": "bc1d75c.d11d988",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 845,
        "y": 300,
        "wires": []
    },
    {
        "id": "22dcafd5.473a8",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 480,
        "y": 300,
        "wires": [
            [
                "c3281764.1b7268"
            ]
        ]
    },
    {
        "id": "f40fdfba.31578",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Process connection status",
        "func": "msg.cmd=[];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.proServIP = flow.get(\"msgProServIP\");\ncptok = flow.get(\"cptok\");\ncpter = flow.get(\"cpter\");\nmsg.serverSiteId = flow.get(\"msgServerSiteId\");\n\n/*if (msg.cmd.siteId === undefined) {\n    msg.cmd.siteId = msg.serverSiteId;\n}*/\n\nif (msg.deviceList !== undefined && msg.proServIP !== undefined && cptok === 0 && msg.statusCode === 200) {\n    cpter = 0;\n    if (msg.cmd.lang === \"de\") {\n        text = \"real KNX Air ist betriebsbereit\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"real KNX Air est à présent prêt à l'emploi\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"real KNX Air is now ready to use\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    cptok++;\n    flow.set(\"cptok\", cptok); // save for later use\n    flow.set(\"cpter\", cpter); // save for later use\n} else if (msg.deviceList === undefined || msg.proServIP === undefined || msg.statusCode !== 200) {\n    cptok = 0;\n    cpter++;\n    if (cpter > 3) {\n        cpter = -1;\n        if (msg.cmd.lang === \"de\") {\n            text = \"Etwas stimmt nicht, ich kann die KNX-Geräte nicht laden. Bitte überprüfen Sie die IP von proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"de-DE\"\n            };\n        } else if (msg.cmd.lang === \"fr\") {\n            text = \"Quelque chose ne va pas, je ne peux pas charger les appareils KNX. Veuillez vérifier l'adresse IP de proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"fr-FR\"\n            };\n        } else {\n            text = \"Something is wrong, I cannot load the KNX devices. Please check the IP of proServ.\";\n            msg.error = {\n                text: text,\n                siteId: msg.cmd.siteId,\n                lang: \"en-EN\"\n            };\n        }\n    }\n    flow.set(\"cptok\", cptok); // save for later use\n    flow.set(\"cpter\", cpter); // save for later use\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1170,
        "y": 860,
        "wires": [
            [
                "52569d1f.0e69b4"
            ]
        ]
    },
    {
        "id": "fcded654.1ebbf8",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "=================================================================GET CONNECTION STATUS=================================================================",
        "info": "",
        "x": 790,
        "y": 800,
        "wires": []
    },
    {
        "id": "ee01c7cd.b39318",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "x": 490,
        "y": 860,
        "wires": [
            [
                "33675444.3d31bc"
            ]
        ]
    },
    {
        "id": "33675444.3d31bc",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "10",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 640,
        "y": 860,
        "wires": [
            [
                "f563aa21.345208"
            ]
        ]
    },
    {
        "id": "52569d1f.0e69b4",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 1315,
        "y": 860,
        "wires": []
    },
    {
        "id": "27a1b28d.f8f4fe",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Store server siteId",
        "func": "tmp = msg.payload.split(\"\\\"\");\ntmp1 = tmp[1].split(\"@\");\nmsg.serverSiteId = tmp1[0];\n\nflow.set(\"msgServerSiteId\", msg.serverSiteId); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1010,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "7042900b.fac84",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "=====================================================================GET SERVER SITE ID==================================================================",
        "info": "",
        "x": 790,
        "y": 1220,
        "wires": []
    },
    {
        "id": "8243cfab.bf49b",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Start GET",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 600,
        "y": 1280,
        "wires": [
            [
                "98ecfcd6.42c7a"
            ]
        ]
    },
    {
        "id": "98ecfcd6.42c7a",
        "type": "exec",
        "z": "69122215.9bd9fc",
        "command": "grep \"bind*\" /etc/snips.toml",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET server siteId",
        "x": 790,
        "y": 1280,
        "wires": [
            [
                "27a1b28d.f8f4fe"
            ],
            [],
            []
        ]
    },
    {
        "id": "7d1bfecf.ec658",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET devices",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{proServIP}}}",
        "tls": "",
        "x": 970,
        "y": 860,
        "wires": [
            [
                "f40fdfba.31578"
            ]
        ]
    },
    {
        "id": "f563aa21.345208",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "GET proServIP",
        "func": "msg.proServIP = flow.get(\"msgProServIP\");\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 800,
        "y": 860,
        "wires": [
            [
                "7d1bfecf.ec658"
            ]
        ]
    },
    {
        "id": "b06e8470.7cbaa8",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "items",
        "x": 830,
        "y": 2160,
        "wires": []
    },
    {
        "id": "2cc72cd4.677924",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 2076.000030517578,
        "y": 1214.0000886917114,
        "wires": []
    },
    {
        "id": "fb4e88cf.d38dd8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 2196.000030517578,
        "y": 1574.0000886917114,
        "wires": []
    },
    {
        "id": "6847e980.340548",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 2576.000030517578,
        "y": 1354.0000886917114,
        "wires": []
    },
    {
        "id": "9c57161f.202548",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 2176.000030517578,
        "y": 1694.0000886917114,
        "wires": []
    },
    {
        "id": "a8e66cba.44ed7",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "url",
        "x": 820,
        "y": 2200,
        "wires": []
    },
    {
        "id": "cd308ff3.36adb",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 1896.0000305175781,
        "y": 1334.0000886917114,
        "wires": []
    },
    {
        "id": "627fe20f.efe74c",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "DEBUG IN",
        "links": [
            "fd2281ac.6edd"
        ],
        "x": 1876.0000305175781,
        "y": 1634.0000886917114,
        "wires": []
    },
    {
        "id": "99de0a6d.888248",
        "type": "exec",
        "z": "69122215.9bd9fc",
        "command": "sudo ip addr show eth0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP (eth)",
        "x": 530,
        "y": 400,
        "wires": [
            [
                "d7483259.fc076"
            ],
            [],
            []
        ]
    },
    {
        "id": "d7483259.fc076",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "outputs": 2,
        "x": 690,
        "y": 400,
        "wires": [
            [
                "7a3a1c69.ddcc24"
            ],
            [
                "b07efa3a.688658"
            ]
        ]
    },
    {
        "id": "7a3a1c69.ddcc24",
        "type": "exec",
        "z": "69122215.9bd9fc",
        "command": "sudo ip addr show wlan0 | grep \"inet\\b\" | awk '{print $2}' | cut -d/ -f1",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "GET local IP (wlan)",
        "x": 850,
        "y": 400,
        "wires": [
            [
                "b07efa3a.688658"
            ],
            [],
            []
        ]
    },
    {
        "id": "b07efa3a.688658",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Trim answer",
        "func": "msg.payload = msg.payload.trim();\n\nflow.set(\"msgServerIP\", msg.payload); // save for later use\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1030,
        "y": 400,
        "wires": [
            [
                "e040fe42.c2b7b",
                "8a541951.9cf2e8"
            ]
        ]
    },
    {
        "id": "985fab7a.b97518",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "===================================================================DYNAMIC VOCABULARY=================================================================",
        "info": "",
        "x": 790,
        "y": 560,
        "wires": []
    },
    {
        "id": "b6d3ec4b.485a2",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 240,
        "wires": [
            [
                "8fcc2c07.9be47"
            ],
            [
                "74965f5f.fccb9"
            ]
        ]
    },
    {
        "id": "15e88677.b3c3ca",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftUpLights",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 240,
        "wires": [
            [
                "401cfe4e.b70de"
            ]
        ]
    },
    {
        "id": "1f524379.b39f6d",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:turnOffLights",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 200,
        "wires": [
            [
                "401cfe4e.b70de"
            ]
        ]
    },
    {
        "id": "fa60f3e1.ba067",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftDownLights",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 280,
        "wires": [
            [
                "401cfe4e.b70de"
            ]
        ]
    },
    {
        "id": "a31cd88c.b91888",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:setBrightnessLights",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 320,
        "wires": [
            [
                "401cfe4e.b70de"
            ]
        ]
    },
    {
        "id": "ca508b26.8ec928",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 480,
        "wires": [
            [
                "2f40d4f9.6383ec",
                "dc2c39f9.a2f638"
            ]
        ]
    },
    {
        "id": "a7f1af9d.d39f9",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:openSetShutters",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 420,
        "wires": [
            [
                "ca508b26.8ec928"
            ]
        ]
    },
    {
        "id": "c0f3735a.e3cec",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftUpShutters",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 500,
        "wires": [
            [
                "ca508b26.8ec928"
            ]
        ]
    },
    {
        "id": "e6f13504.00c3a8",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:closeSetShutters",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 460,
        "wires": [
            [
                "ca508b26.8ec928"
            ]
        ]
    },
    {
        "id": "4aa7d0da.0063a",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftDownShutters",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 540,
        "wires": [
            [
                "ca508b26.8ec928"
            ]
        ]
    },
    {
        "id": "dd0daee2.d92c5",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 660,
        "wires": [
            [
                "8aece76c.2442a8",
                "5947ccf0.182ce4"
            ]
        ]
    },
    {
        "id": "fd7feed5.ae362",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:setThermostats",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 640,
        "wires": [
            [
                "dd0daee2.d92c5"
            ]
        ]
    },
    {
        "id": "fe22e7bc.a34c28",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:shiftThermostats",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 680,
        "wires": [
            [
                "dd0daee2.d92c5"
            ]
        ]
    },
    {
        "id": "44b58690.8c6758",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 800,
        "wires": [
            [
                "428511cf.105c4",
                "9cb02a96.2fce58"
            ]
        ]
    },
    {
        "id": "23e16f33.c8c54",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:activateScenes",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 800,
        "wires": [
            [
                "44b58690.8c6758"
            ]
        ]
    },
    {
        "id": "f8cfed3f.3d9e5",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:turnOnLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:turnOffLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftUpLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftDownLights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:setBrightnessLights",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 5,
        "x": 2720,
        "y": 240,
        "wires": [
            [
                "b7ab8dde.f7379"
            ],
            [
                "e142d368.0d551"
            ],
            [
                "984fc1f1.e5bb1"
            ],
            [
                "f2359516.7f40a8"
            ],
            [
                "380354a5.ba672c"
            ]
        ]
    },
    {
        "id": "74965f5f.fccb9",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 260,
        "wires": []
    },
    {
        "id": "8fcc2c07.9be47",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findSwitchByKey(array, key, value) {\n    msg.payload.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.payload.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'light_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"lights\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.rawDevice = rawDevice;\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n    \tmsg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n        cpt++;\n        if (msg.cmd.device[i] === \"light\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"licht\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"lumiere\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"everything\" ) {\n            delete msg.cmd.device;\n            break;\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindSwitchByKey(msg.deviceList, 'type', 'lights');\nfindDimmerByKey(msg.deviceList, 'type', 'dimmers');\nmsg.items = msg.payload.switch_lights.concat(msg.payload.dimmer_lights);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nif (msg.cmd.room !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Licht nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cette lumière\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this light\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 220,
        "wires": [
            [
                "d3079650.e82968"
            ]
        ]
    },
    {
        "id": "d3079650.e82968",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 220,
        "wires": [
            [
                "81b227bb.71b548"
            ],
            [
                "f8cfed3f.3d9e5"
            ]
        ]
    },
    {
        "id": "81b227bb.71b548",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2675,
        "y": 160,
        "wires": []
    },
    {
        "id": "e142d368.0d551",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"off\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 200,
        "wires": [
            [
                "f5231fab.2c42c"
            ]
        ]
    },
    {
        "id": "984fc1f1.e5bb1",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"increase\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 240,
        "wires": [
            [
                "c527a251.a31db"
            ]
        ]
    },
    {
        "id": "f2359516.7f40a8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"decrease\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 280,
        "wires": [
            [
                "f48ab389.27a1d"
            ]
        ]
    },
    {
        "id": "380354a5.ba672c",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 320,
        "wires": [
            [
                "9f5fe75e.467ce8"
            ]
        ]
    },
    {
        "id": "18b0e9a5.f3e916",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 160,
        "wires": []
    },
    {
        "id": "f5231fab.2c42c",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 200,
        "wires": []
    },
    {
        "id": "c527a251.a31db",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 240,
        "wires": []
    },
    {
        "id": "f48ab389.27a1d",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 280,
        "wires": []
    },
    {
        "id": "9f5fe75e.467ce8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 320,
        "wires": []
    },
    {
        "id": "b62823bc.445d2",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"40951a47-03ec-447e-8bf8-9302374e892e\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"set the brightness of the wall to fifty percent in the home cinema\",\"asrTokens\":[[{\"value\":\"set\",\"confidence\":1,\"range_start\":0,\"range_end\":3,\"time\":{\"start\":0,\"end\":0.48}},{\"value\":\"the\",\"confidence\":1,\"range_start\":4,\"range_end\":7,\"time\":{\"start\":0.48,\"end\":0.63}},{\"value\":\"brightness\",\"confidence\":1,\"range_start\":8,\"range_end\":18,\"time\":{\"start\":0.63,\"end\":1.29}},{\"value\":\"of\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.29,\"end\":1.5}},{\"value\":\"the\",\"confidence\":1,\"range_start\":22,\"range_end\":25,\"time\":{\"start\":1.5,\"end\":1.68}},{\"value\":\"wall\",\"confidence\":0.974062,\"range_start\":26,\"range_end\":30,\"time\":{\"start\":1.68,\"end\":2.4031124}},{\"value\":\"to\",\"confidence\":1,\"range_start\":31,\"range_end\":33,\"time\":{\"start\":2.4031124,\"end\":2.9099998}},{\"value\":\"fifty\",\"confidence\":0.9698206,\"range_start\":34,\"range_end\":39,\"time\":{\"start\":2.9099998,\"end\":3.36}},{\"value\":\"percent\",\"confidence\":0.6872867,\"range_start\":40,\"range_end\":47,\"time\":{\"start\":3.36,\"end\":3.57}},{\"value\":\"in\",\"confidence\":1,\"range_start\":48,\"range_end\":50,\"time\":{\"start\":3.57,\"end\":3.78}},{\"value\":\"the\",\"confidence\":1,\"range_start\":51,\"range_end\":54,\"time\":{\"start\":3.78,\"end\":3.87}},{\"value\":\"home\",\"confidence\":1,\"range_start\":55,\"range_end\":59,\"time\":{\"start\":3.87,\"end\":3.87}},{\"value\":\"cinema\",\"confidence\":1,\"range_start\":60,\"range_end\":66,\"time\":{\"start\":3.87,\"end\":5.46}}]],\"intent\":{\"intentName\":\"ProKNX:turnOffLights\",\"probability\":0.65861675},\"slots\":[{\"confidence\":0.9698206,\"rawValue\":\"fifty\",\"value\":{\"kind\":\"custom\",\"value\":\"light\"},\"range\":{\"start\":34,\"end\":39},\"entity\":\"light_device\",\"slotName\":\"light_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":55,\"end\":66},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 280,
        "wires": [
            [
                "452ddbb4.bf7ed4"
            ]
        ]
    },
    {
        "id": "437224d4.c8771c",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "siteID replace ' ' with '_'",
        "func": "if(msg.payload.siteId)\n    msg.payload.siteId = msg.payload.siteId.replace(/ /g,\"_\");\nelse\n    msg.payload.siteId = \"default\";\n// if silent and Okey msg and lights command, then skip the 'okey'\nif(flow.get(\"snipssilent\")==='true' && msg.payload.text.length<5 && msg.topic.indexOf('Lights')>0)\n  return;\n  \nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 2730,
        "y": 1960,
        "wires": [
            [
                "39633ab4.8b12f6"
            ]
        ]
    },
    {
        "id": "107bbbcb.331074",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2095,
        "y": 200,
        "wires": []
    },
    {
        "id": "2f40d4f9.6383ec",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2095,
        "y": 440,
        "wires": []
    },
    {
        "id": "8aece76c.2442a8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2095,
        "y": 620,
        "wires": []
    },
    {
        "id": "428511cf.105c4",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2095,
        "y": 760,
        "wires": []
    },
    {
        "id": "158677bc.ca43f8",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/ProKNX:deviceStatusCheck",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 1820,
        "y": 960,
        "wires": [
            [
                "34852ac7.d84936"
            ]
        ]
    },
    {
        "id": "34852ac7.d84936",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2010,
        "y": 960,
        "wires": [
            [
                "79c956b2.1a6d28",
                "4bd81aa3.10d114"
            ]
        ]
    },
    {
        "id": "79c956b2.1a6d28",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2095,
        "y": 920,
        "wires": []
    },
    {
        "id": "a20cbfde.dfbd6",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 420,
        "wires": [
            [
                "60d4eb6c.4e06e4"
            ]
        ]
    },
    {
        "id": "f6d4845a.2b2d68",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:openSetShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:closeSetShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftUpShutters",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:shiftDownShutters",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 4,
        "x": 2720,
        "y": 480,
        "wires": [
            [
                "a20cbfde.dfbd6"
            ],
            [
                "dfc6f21a.4bba5"
            ],
            [
                "ca36ec13.1dbbd"
            ],
            [
                "1f350016.6af4a"
            ]
        ]
    },
    {
        "id": "afad51f7.3ad2f",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'window_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"blinds\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.rawDevice = rawDevice;\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n    \tmsg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n        cpt++;\n        if (msg.cmd.device[i] === \"all shutters\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        } else if (msg.cmd.device[i] === \"alle rollladen\") {\n            delete msg.cmd.device[i];\n            cpt--;\n            if (rawDevice.length == 1) {delete msg.cmd.device;}\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    msg.test = tmpList;\n    if (tmpList[0] !== undefined) {} else {\n        for (var i = 0; i < tmpList.length; i++) {\n            tmp = [];\n            for (var n = 0; n < tmpList[i].length; n++) {\n                tmp.push(tmpList[i][n]);\n            }\n        }\n    }\n}\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann diesen Rolladen nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver ce volet\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this shutter\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 460,
        "wires": [
            [
                "ce50dd2e.83f74"
            ]
        ]
    },
    {
        "id": "ce50dd2e.83f74",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 460,
        "wires": [
            [
                "1c8386fb.dff249"
            ],
            [
                "f6d4845a.2b2d68"
            ]
        ]
    },
    {
        "id": "1c8386fb.dff249",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 420,
        "wires": []
    },
    {
        "id": "dfc6f21a.4bba5",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"off\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 460,
        "wires": [
            [
                "c3d0d578.9e32f8"
            ]
        ]
    },
    {
        "id": "ca36ec13.1dbbd",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"increase\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 500,
        "wires": [
            [
                "7c8314a.90f59ec"
            ]
        ]
    },
    {
        "id": "1f350016.6af4a",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"decrease\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 540,
        "wires": [
            [
                "c4d65001.d8d62"
            ]
        ]
    },
    {
        "id": "60d4eb6c.4e06e4",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 420,
        "wires": []
    },
    {
        "id": "c3d0d578.9e32f8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 460,
        "wires": []
    },
    {
        "id": "7c8314a.90f59ec",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 500,
        "wires": []
    },
    {
        "id": "c4d65001.d8d62",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 540,
        "wires": []
    },
    {
        "id": "14a0bfb0.68ddf",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "String.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nvar rawAction = findObjectByKey(msg.payload.slots, 'slotName', 'up_down');\n\nif (rawAction[0].value.value.toLowerCase().sansAccent() === \"up\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"hoher\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"plus chaud\") {\n    msg.cmd.cmd = \"increase\";\n} else if (rawAction[0].value.value.toLowerCase().sansAccent() === \"down\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"niedriger\" || rawAction[0].value.value.toLowerCase().sansAccent() === \"plus froid\") {\n    msg.cmd.cmd = \"decrease\";\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 640,
        "wires": [
            [
                "86a06f86.12924"
            ]
        ]
    },
    {
        "id": "41ef9d23.f045c4",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:shiftThermostats",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ProKNX:setThermostats",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2720,
        "y": 660,
        "wires": [
            [
                "14a0bfb0.68ddf"
            ],
            [
                "60330073.3bb11"
            ]
        ]
    },
    {
        "id": "19c81099.f4692f",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'temperature_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'temperature');\nvar rawUpDown = findObjectByKey(msg.payload.slots, 'slotName', 'up_down');\nmsg.cmd.type = \"heating\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.cmd.device = [];\n    for (var i = 0; i < rawDevice.length; i++) {\n\t    msg.cmd.device[i] = rawDevice[i].value.value.toLowerCase().sansAccent();\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n}\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Thermostat nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver ce thermostat\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this thermostat\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 640,
        "wires": [
            [
                "7d210a4a.9036b4"
            ]
        ]
    },
    {
        "id": "7d210a4a.9036b4",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 640,
        "wires": [
            [
                "245fd482.49989c"
            ],
            [
                "41ef9d23.f045c4"
            ]
        ]
    },
    {
        "id": "245fd482.49989c",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 620,
        "wires": []
    },
    {
        "id": "60330073.3bb11",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"set\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 680,
        "wires": [
            [
                "1e0e1df2.1bf4b2"
            ]
        ]
    },
    {
        "id": "86a06f86.12924",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 640,
        "wires": []
    },
    {
        "id": "1e0e1df2.1bf4b2",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "fd2281ac.6edd",
            "f8d51e40.8061c"
        ],
        "x": 3035,
        "y": 680,
        "wires": []
    },
    {
        "id": "c955eca4.2e4f1",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"bad1fb80-9c46-42de-80c4-7ac8c52b4132\",\"customData\":null,\"siteId\":\"default\",\"input\":\"open home cinema shutter\",\"asrTokens\":[[{\"value\":\"öffne\",\"confidence\":1,\"range_start\":0,\"range_end\":5,\"time\":{\"start\":0,\"end\":0.71999997}},{\"value\":\"die\",\"confidence\":1,\"range_start\":6,\"range_end\":9,\"time\":{\"start\":0.71999997,\"end\":0.78}},{\"value\":\"lamellen\",\"confidence\":1,\"range_start\":10,\"range_end\":18,\"time\":{\"start\":0.78,\"end\":1.23}},{\"value\":\"im\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.23,\"end\":1.53}},{\"value\":\"wohnzimmer\",\"confidence\":1,\"range_start\":22,\"range_end\":32,\"time\":{\"start\":1.53,\"end\":2.73}}]],\"intent\":{\"intentName\":\"ProKNX:openSetShutters\",\"probability\":1},\"slots\":[{\"confidence\":1,\"rawValue\":\"shutter\",\"value\":{\"kind\":\"Custom\",\"value\":\"shutters\"},\"range\":{\"start\":6,\"end\":18},\"entity\":\"window_devices\",\"slotName\":\"window_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":22,\"end\":32},\"entity\":\"room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 520,
        "wires": [
            [
                "dc2c39f9.a2f638"
            ]
        ]
    },
    {
        "id": "259207e6.6da848",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"40951a47-03ec-447e-8bf8-9302374e892e\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"set the brightness of the wall to fifty percent in the home cinema\",\"intent\":{\"intentName\":\"ProKNX:shiftThermostats\",\"probability\":0.75861675},\"slots\":[{\"confidence\":0.974062,\"rawValue\":\"up\",\"value\":{\"kind\":\"Custom\",\"value\":\"down\"},\"range\":{\"start\":26,\"end\":30},\"entity\":\"up_down\",\"slotName\":\"up_down\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":55,\"end\":66},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 700,
        "wires": [
            [
                "5947ccf0.182ce4"
            ]
        ]
    },
    {
        "id": "4aaf994d.855928",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Set_cmd",
        "func": "msg.cmd.cmd = \"on\";\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2920,
        "y": 800,
        "wires": [
            [
                "7a26df.abd3492"
            ]
        ]
    },
    {
        "id": "49d221b0.0c03",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Route requests",
        "property": "payload.intent.intentName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ProKNX:activateScenes",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "outputs": 1,
        "x": 2720,
        "y": 800,
        "wires": [
            [
                "4aaf994d.855928"
            ]
        ]
    },
    {
        "id": "81679615.1ccbf8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Array_intent",
        "func": "msg.cmd = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawDevice = findObjectByKey(msg.payload.slots, 'slotName', 'scene_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.type = \"scenes\";\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawDevice !== null) {\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawDevice.length; i++) {\n        if (rawDevice[i].value.value.toLowerCase().sansAccent() !== \"scene\" && rawDevice[i].value.value.toLowerCase().sansAccent() !== \"szene\") {\n    \t    msg.cmd.device[cpt] = rawDevice[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n}\n\nif (rawValue !== null) {\n\tmsg.cmd.value = precisionRound(rawValue[0].value.value, 1);\n}\n\ntmp = [];\nfindTypeByKey(msg.deviceList, 'type', msg.cmd.type);\ntmp = msg.items;\n\nif (msg.cmd.device !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.device.length; i++) {\n        findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\nif (msg.cmd.room !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n} else {tmp = [];}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann diese Szene nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cette scène\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this scene\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 780,
        "wires": [
            [
                "c8206201.63432"
            ]
        ]
    },
    {
        "id": "c8206201.63432",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 780,
        "wires": [
            [
                "a70c55dc.effe58"
            ],
            [
                "49d221b0.0c03"
            ]
        ]
    },
    {
        "id": "a70c55dc.effe58",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 760,
        "wires": []
    },
    {
        "id": "7a26df.abd3492",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "COMMAND EXECUTION IN",
        "links": [
            "f8d51e40.8061c",
            "fd2281ac.6edd"
        ],
        "x": 3035,
        "y": 800,
        "wires": []
    },
    {
        "id": "42bce9cc.52d5f8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Array_intent",
        "func": "msg.cmd = [];\ntmp = [];\nmsg.items = [];\nmsg.deviceList = flow.get(\"msgDeviceList\");\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.proServIP = flow.get(\"msgProServIP\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction precisionRound(number, precision) {\n  var factor = Math.pow(10, precision);\n  return Math.round(number * factor) / factor;\n}\n\nfunction findObjectByKey(array, key, value) {\n    items=[];\n    var cpt=0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            items[cpt]=array[i];\n            cpt++;\n        }\n    }\n    if (items[0] !== undefined) {\n        return items;\n    } else {\n        return null;\n    }\n}\n\nfunction findRoomByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDeviceByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key].toLowerCase().sansAccent();\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findSwitchByKey(array, key, value) {\n    msg.payload.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.payload.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.payload.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nvar rawRoom = findObjectByKey(msg.payload.slots, 'slotName', 'room');\nvar rawLight = findObjectByKey(msg.payload.slots, 'slotName', 'light_device');\nvar rawShutter = findObjectByKey(msg.payload.slots, 'slotName', 'window_device');\nvar rawTherm = findObjectByKey(msg.payload.slots, 'slotName', 'temperature_device');\nvar rawScene = findObjectByKey(msg.payload.slots, 'slotName', 'scene_device');\nvar rawValue = findObjectByKey(msg.payload.slots, 'slotName', 'value');\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\nmsg.cmd.query = true;\n\nif (rawRoom !== null) {\n    msg.cmd.room = [];\n    for (var i = 0; i < rawRoom.length; i++) {\n        msg.cmd.room[i] = rawRoom[i].value.value.toLowerCase().sansAccent();\n        if (msg.cmd.room[i] === \"here\" ||msg.cmd.room[i] === \"hier\" || msg.cmd.room[i] === \"ici\" ) {\n            msg.cmd.room[i] = msg.payload.siteId.replace(/_/g,\" \");\n        }\n        if (msg.cmd.room[i] === \"everywhere\" || msg.cmd.room[i] === \"uberall\" || msg.cmd.room[i] === \"partout\"){\n            delete msg.cmd.room;\n            break;\n        }\n    }\n} else {\n    msg.cmd.room = [];\n    msg.cmd.room[0] = msg.payload.siteId.replace(/_/g,\" \");\n}\n\nif (rawLight !== null) {\n    msg.cmd.type = \"lights\";\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawLight.length; i++) {\n        if (rawLight[i].value.value.toLowerCase().sansAccent() !== \"light\" && rawLight[i].value.value.toLowerCase().sansAccent() !== \"licht\" && rawLight[i].value.value.toLowerCase().sansAccent() !== \"lumiere\") {\n    \t    msg.cmd.device[cpt] = rawLight[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n    tmp = [];\n    findSwitchByKey(msg.deviceList, 'type', 'lights');\n    findDimmerByKey(msg.deviceList, 'type', 'dimmers');\n    msg.items = msg.payload.switch_lights.concat(msg.payload.dimmer_lights);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        msg.tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            msg.tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        tmp = [];\n        for (var i = 0; i < msg.tmpList.length; i++) {\n            for (var n = 0; n < msg.tmpList[i].length; n++) {\n                tmp.push(msg.tmpList[i][n]);\n            }\n        }\n    }\n} else if (rawShutter !== null) {\n    msg.cmd.type = \"blinds\";\n    cpt = 0;\n    msg.cmd.device = [];\n    for (var i = 0; i < rawShutter.length; i++) {\n        msg.cmd.device[cpt] = rawShutter[i].value.value.toLowerCase().sansAccent();\n    }\n\n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n    }\n} else if (rawTherm !== null) {\n    msg.cmd.type = \"heating\";\n    cpt = 0;\n        msg.cmd.device = [];\n        for (var i = 0; i < rawTherm.length; i++) {\n\t        msg.cmd.device[cpt] = rawTherm[i].value.value.toLowerCase().sansAccent();\n        }\n        \n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n    tmpList = [];\n    cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        if (tmpList[0][0]!== undefined) {\n            if (tmpList[0][0].name!== undefined) {\n                tmp = [];\n                for (var i = 0; i < tmpList.length; i++) {\n                    for (var n = 0; n < tmpList[i].length; n++) {\n                        tmp.push(tmpList[i][n]);\n                    }\n                }\n            }\n        } else {}\n    }\n} else if (rawScene !== null) {\n    msg.cmd.type = \"scenes\";\n    msg.cmd.device = [];\n    cpt = 0;\n    for (var i = 0; i < rawScene.length; i++) {\n        if (rawScene[i].value.value.toLowerCase().sansAccent() !== \"scene\" && RawScene[i].value.value.toLowerCase().sansAccent() !== \"all\") {\n    \t    msg.cmd.device[cpt] = rawScene[i].value.value.toLowerCase().sansAccent();\n            cpt++;\n        }\n    }\n    tmp = [];\n    findTypeByKey(msg.deviceList, 'type', msg.cmd.type);\n    tmp = msg.items;\n\n    if (msg.cmd.device[0] !== undefined) {\n        msg.tmpList = [];\n        cpt = 0;\n        for (var i = 0; i < msg.cmd.device.length; i++) {\n            findDeviceByKey(tmp, 'object', msg.cmd.device[i]);\n            msg.tmpList[cpt] = msg.items;\n            cpt++;\n        }\n        tmp = [];\n        for (var i = 0; i < msg.tmpList.length; i++) {\n            for (var n = 0; n < msg.tmpList[i].length; n++) {\n                tmp.push(msg.tmpList[i][n]);\n            }\n        }\n    }\n}\n\nif (msg.cmd.room !== undefined && tmp !== undefined) {\n    tmpList = [];\n    cpt = 0;\n    for (var i = 0; i < msg.cmd.room.length; i++) {\n        findRoomByKey(tmp, 'zone', msg.cmd.room[i]);\n        tmpList[cpt] = msg.items;\n        cpt++;\n    }\n    tmp = [];\n    for (var i = 0; i < tmpList.length; i++) {\n        for (var n = 0; n < tmpList[i].length; n++) {\n            tmp.push(tmpList[i][n]);\n        }\n    }\n}\n\nmsg.items = tmp;\n\nif (msg.items[0] === undefined) {\n    if (msg.cmd.lang === \"de\") {\n        msg.error = {\n            text: \"Ich kann dieses Gerät nicht finden\",\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        msg.error = {\n            text: \"Je n'ai pas pu trouver cet appareil\",\n            siteId: msg.cmd.siteId,\n            lang:\"fr-FR\"\n        };\n    } else {\n        msg.error = {\n            text: \"I can not find this device\",\n            siteId: msg.cmd.siteId,\n            lang:\"en-EN\"\n        };\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2390,
        "y": 940,
        "wires": [
            [
                "d60c0529.bfca88"
            ]
        ]
    },
    {
        "id": "d60c0529.bfca88",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Items ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "null"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2540,
        "y": 960,
        "wires": [
            [
                "652ba7e3.d0d728"
            ],
            [
                "7e44759b.48d93c"
            ]
        ]
    },
    {
        "id": "652ba7e3.d0d728",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2655,
        "y": 940,
        "wires": []
    },
    {
        "id": "7e44759b.48d93c",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "QUERY EXECUTION IN",
        "links": [
            "1d9c0479.88924c",
            "fd2281ac.6edd"
        ],
        "x": 2655,
        "y": 980,
        "wires": []
    },
    {
        "id": "40e3eab7.d786d4",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"ada95fa7-80bc-4a75-86dd-1c43e4921950\",\"customData\":null,\"siteId\":\"default\",\"input\":\"what 's the status of the blinds in the home cinema\",\"asrTokens\":[[{\"value\":\"what\",\"confidence\":1,\"range_start\":0,\"range_end\":4,\"time\":{\"start\":0,\"end\":1.02}},{\"value\":\"'s\",\"confidence\":1,\"range_start\":5,\"range_end\":7,\"time\":{\"start\":1.02,\"end\":1.14}},{\"value\":\"the\",\"confidence\":0.9781889,\"range_start\":8,\"range_end\":11,\"time\":{\"start\":1.14,\"end\":1.316074}},{\"value\":\"status\",\"confidence\":1,\"range_start\":12,\"range_end\":18,\"time\":{\"start\":1.316074,\"end\":1.8299999}},{\"value\":\"of\",\"confidence\":1,\"range_start\":19,\"range_end\":21,\"time\":{\"start\":1.8299999,\"end\":1.9799999}},{\"value\":\"the\",\"confidence\":0.9132247,\"range_start\":22,\"range_end\":25,\"time\":{\"start\":1.9799999,\"end\":2.7471087}},{\"value\":\"blinds\",\"confidence\":1,\"range_start\":26,\"range_end\":32,\"time\":{\"start\":2.7471087,\"end\":2.9099998}},{\"value\":\"in\",\"confidence\":1,\"range_start\":33,\"range_end\":35,\"time\":{\"start\":2.9099998,\"end\":3.06}},{\"value\":\"the\",\"confidence\":1,\"range_start\":36,\"range_end\":39,\"time\":{\"start\":3.06,\"end\":3.3}},{\"value\":\"home\",\"confidence\":1,\"range_start\":40,\"range_end\":44,\"time\":{\"start\":3.3,\"end\":3.3899999}},{\"value\":\"cinema\",\"confidence\":1,\"range_start\":45,\"range_end\":51,\"time\":{\"start\":3.3899999,\"end\":4.62}}]],\"intent\":{\"intentName\":\"ProKNX:deviceStatusCheck\",\"probability\":0.99101967},\"slots\":[{\"confidence\":1,\"rawValue\":\"blinds\",\"value\":{\"kind\":\"Custom\",\"value\":\"blinds\"},\"range\":{\"start\":26,\"end\":32},\"entity\":\"window_device\",\"slotName\":\"window_device\"},{\"confidence\":1,\"rawValue\":\"home cinema\",\"value\":{\"kind\":\"Custom\",\"value\":\"home cinema\"},\"range\":{\"start\":40,\"end\":51},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 1000,
        "wires": [
            [
                "4bd81aa3.10d114"
            ]
        ]
    },
    {
        "id": "b8109d0d.b62a2",
        "type": "split",
        "z": "69122215.9bd9fc",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 2350,
        "y": 1980,
        "wires": [
            [
                "2afdded3.b35982"
            ]
        ]
    },
    {
        "id": "62c10b35.0140a4",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Inject English",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2405.9999771118164,
        "y": 2062.000647544861,
        "wires": [
            [
                "38a2d5c5.adba3a"
            ]
        ]
    },
    {
        "id": "38a2d5c5.adba3a",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "msg EN",
        "func": "msg.payload = {\n    text: \"Hello, this is a test message!\",\n    siteId: \"default\",\n    lang: \"en-UK\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2559.999969482422,
        "y": 2062.000159263611,
        "wires": [
            [
                "39633ab4.8b12f6"
            ]
        ]
    },
    {
        "id": "21fcf4f8.1c117c",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "msg FR",
        "func": "msg.payload = {\n    text: \"Bonjour, ceci est un message de test!\",\n    siteId: \"default\",\n    lang: \"fr-FR\"\n};\n\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2559.286865234375,
        "y": 2106.369384765625,
        "wires": [
            [
                "39633ab4.8b12f6"
            ]
        ]
    },
    {
        "id": "d0a7ff94.22fc",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Inject French",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2405.2868728637695,
        "y": 2106.369873046875,
        "wires": [
            [
                "21fcf4f8.1c117c"
            ]
        ]
    },
    {
        "id": "c2e86667.a342c8",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "msg DE",
        "func": "msg.payload = {\n    text: \"Hallo, das ist eine Testnachricht!\",\n    siteId: \"default\",\n    lang: \"de-DE\"\n};\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2560.286865234375,
        "y": 2150.369384765625,
        "wires": [
            [
                "39633ab4.8b12f6"
            ]
        ]
    },
    {
        "id": "b78a234b.d3dd3",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "Inject German",
        "topic": "",
        "payload": "true",
        "payloadType": "bool",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2406.2868728637695,
        "y": 2150.369873046875,
        "wires": [
            [
                "c2e86667.a342c8"
            ]
        ]
    },
    {
        "id": "86eaf1e7.8a31b",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"f4bfcec4-95e6-4258-bbae-090cddd189db\",\"customData\":null,\"siteId\":\"bedroom\",\"input\":\"activate\",\"asrTokens\":[[{\"value\":\"activate\",\"confidence\":1,\"range_start\":0,\"range_end\":8,\"time\":{\"start\":0,\"end\":1.89}}]],\"intent\":{\"intentName\":\"ProKNX:activateScenes\",\"probability\":0.81419545},\"slots\":[{\"confidence\":1,\"rawValue\":\"activate\",\"value\":{\"kind\":\"Custom\",\"value\":\"activate\"},\"range\":{\"start\":0,\"end\":8},\"entity\":\"scene_name\",\"slotName\":\"scene_device\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 2010,
        "y": 840,
        "wires": [
            [
                "9cb02a96.2fce58"
            ]
        ]
    },
    {
        "id": "66aee6b0.35aa38",
        "type": "http in",
        "z": "69122215.9bd9fc",
        "name": "",
        "url": "/hello",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 2398.9233360290527,
        "y": 2213.1875915527344,
        "wires": [
            [
                "3363c5a7.1be1da",
                "ac4c07f3.55d018"
            ]
        ]
    },
    {
        "id": "3363c5a7.1be1da",
        "type": "http response",
        "z": "69122215.9bd9fc",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 2560,
        "y": 2260,
        "wires": []
    },
    {
        "id": "ac4c07f3.55d018",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "msg",
        "func": "if(!msg.payload){\n    msg.payload = {\n        text: \"Hello!\",\n        siteId: \"default\",\n        lang: \"en-UK\"\n    };\n}\nreturn msg;",
        "outputs": "1",
        "noerr": 0,
        "x": 2550,
        "y": 2220,
        "wires": [
            [
                "39633ab4.8b12f6"
            ]
        ]
    },
    {
        "id": "452ddbb4.bf7ed4",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 240,
        "wires": [
            [
                "b6d3ec4b.485a2"
            ]
        ]
    },
    {
        "id": "d4d3327b.9062",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 480,
        "wires": [
            [
                "afad51f7.3ad2f"
            ],
            [
                "f4408acb.881708"
            ]
        ]
    },
    {
        "id": "f4408acb.881708",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 500,
        "wires": []
    },
    {
        "id": "dc2c39f9.a2f638",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 480,
        "wires": [
            [
                "d4d3327b.9062"
            ]
        ]
    },
    {
        "id": "3cc7162a.1a9b1a",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 660,
        "wires": [
            [
                "19c81099.f4692f"
            ],
            [
                "123877e6.941818"
            ]
        ]
    },
    {
        "id": "123877e6.941818",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 680,
        "wires": []
    },
    {
        "id": "5947ccf0.182ce4",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 660,
        "wires": [
            [
                "3cc7162a.1a9b1a"
            ]
        ]
    },
    {
        "id": "b6ce1dfb.ac389",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 800,
        "wires": [
            [
                "81679615.1ccbf8"
            ],
            [
                "6098631e.c2f35c"
            ]
        ]
    },
    {
        "id": "6098631e.c2f35c",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 820,
        "wires": []
    },
    {
        "id": "9cb02a96.2fce58",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 800,
        "wires": [
            [
                "b6ce1dfb.ac389"
            ]
        ]
    },
    {
        "id": "c264267c.d5bf58",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 2250,
        "y": 960,
        "wires": [
            [
                "42bce9cc.52d5f8"
            ],
            [
                "d892650c.b3fb08"
            ]
        ]
    },
    {
        "id": "d892650c.b3fb08",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "ERROR IN",
        "links": [
            "b50598ee.e88898",
            "8be6dbfa.f122e8",
            "ce8c5acd.622cd8"
        ],
        "x": 2335,
        "y": 980,
        "wires": []
    },
    {
        "id": "4bd81aa3.10d114",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Filter",
        "func": "msg.cmd = [];\nmsg.cmd.lang = flow.get(\"msgLang\");\nmsg.cmd.siteId = msg.payload.siteId.replace(/_/g,\" \");\n\nif (msg.payload.intent.probability < 0.4 || msg.payload.asrTokens[0].length <= 1) {}\nelse if (msg.payload.intent.probability > 0.4 && msg.payload.intent.probability < 0.6){\n    if (msg.cmd.lang === \"de\") {\n        text = \"Entschuldigung, Ich habe deine Anweisung nicht verstanden\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"de-DE\"\n        };\n    } else if (msg.cmd.lang === \"fr\") {\n        text = \"Désolé, je n'ai pas compris la commande\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"fr-FR\"\n        };\n    } else {\n        text = \"Sorry, I do not understand your command\";\n        msg.error = {\n            text: text,\n            siteId: msg.cmd.siteId,\n            lang: \"en-EN\"\n        };\n    }\n    return msg;\n} else {\n    return msg;\n}",
        "outputs": 1,
        "noerr": 0,
        "x": 2130,
        "y": 960,
        "wires": [
            [
                "c264267c.d5bf58"
            ]
        ]
    },
    {
        "id": "2596123.24550ee",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "",
        "property": "cmd.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "lights",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "blinds",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "outputs": 3,
        "x": 1930,
        "y": 2000,
        "wires": [
            [
                "d6cfb2a2.8b3d2"
            ],
            [
                "d6cfb2a2.8b3d2"
            ],
            [
                "1ed73ec2.721891"
            ]
        ]
    },
    {
        "id": "c99f1c6a.e1a1d",
        "type": "mqtt in",
        "z": "69122215.9bd9fc",
        "name": "MQTT IN",
        "topic": "hermes/intent/Joseph:searchWeatherForecast",
        "qos": "2",
        "broker": "4921ae70.68c63",
        "x": 2240,
        "y": 1040,
        "wires": [
            [
                "b40d90ca.b9fee"
            ]
        ]
    },
    {
        "id": "cfb6a05c.0beae",
        "type": "json",
        "z": "69122215.9bd9fc",
        "name": "",
        "pretty": true,
        "x": 2530,
        "y": 1040,
        "wires": [
            [
                "1e8c5e32.2d35e2"
            ]
        ]
    },
    {
        "id": "1e8c5e32.2d35e2",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "Session IN",
        "links": [
            "b0b83fb4.18e6c"
        ],
        "x": 2615,
        "y": 1040,
        "wires": []
    },
    {
        "id": "b40d90ca.b9fee",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2380,
        "y": 1040,
        "wires": [
            [
                "cfb6a05c.0beae"
            ]
        ]
    },
    {
        "id": "efb90d1a.4e84a",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Build list",
        "func": "var version = flow.get(\"msgVersion\");\nmsg.deviceList = flow.get(\"msgDeviceList\");\n\nString.prototype.sansAccent = function() {\n    var accent = [\n        /[\\300-\\306]/g, /[\\340-\\346]/g, // A, a\n        /[\\310-\\313]/g, /[\\350-\\353]/g, // E, e\n        /[\\314-\\317]/g, /[\\354-\\357]/g, // I, i\n        /[\\322-\\330]/g, /[\\362-\\370]/g, // O, o\n        /[\\331-\\334]/g, /[\\371-\\374]/g, // U, u\n        /[\\321]/g, /[\\361]/g, // N, n\n        /[\\307]/g, /[\\347]/g, // C, c\n    ];\n    var noaccent = ['A','a','E','e','I','i','O','o','U','u','N','n','C','c'];\n     \n    var str = this;\n    for(var i = 0; i < accent.length; i++){\n        str = str.replace(accent[i], noaccent[i]);\n    }\n     \n    return str;\n};\n\nfunction findSwitchByKey(array, key, value) {\n    msg.switch_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.switch_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findDimmerByKey(array, key, value) {\n    msg.dimmer_lights = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        if (array[i][key] === value) {\n            msg.dimmer_lights[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findTypeByKey(array, key, value) {\n    msg.items = [];\n    var cpt = 0;\n    for (var i = 0; i < array.length; i++) {\n        var x = array[i][key];\n        if (x === value) {\n            msg.items[cpt] = array[i];\n            cpt ++;\n        }\n    }\n    return null;\n}\n\nfunction findLightsByKey() {\n    msg.items = [];\n    findSwitchByKey(msg.deviceList, 'type', 'lights');\n    findDimmerByKey(msg.deviceList, 'type', 'dimmers');\n    msg.items = msg.switch_lights.concat(msg.dimmer_lights);\n    return null;\n}\n\nvar ETSNamesRoom = [];\nfunction buildETSNamesList(array, key, value) {\n    var ETSNamesDevice = [];\n    if (value === \"lights\") {\n        findLightsByKey();\n    } else {\n        findTypeByKey(array, key, value);\n    }\n    \n    for (var i = 0; i < msg.items.length; i++) {\n        if (ETSNamesDevice.indexOf(\"\\\"\"+msg.items[i].object.toLowerCase().sansAccent()+\"\\\"\") === -1) {\n            ETSNamesDevice.push(\"\\\"\"+msg.items[i].object.toLowerCase().sansAccent()+\"\\\"\");\n        }\n        if (ETSNamesRoom.indexOf(\"\\\"\"+msg.items[i].zone.toLowerCase().sansAccent()+\"\\\"\") === -1) {\n            ETSNamesRoom.push(\"\\\"\"+msg.items[i].zone.toLowerCase().sansAccent()+\"\\\"\");\n        }\n    }\n    return ETSNamesDevice;\n}\n\nvar language = flow.get(\"msgLang\");\nvar dynamicInjectSupported = false;\nvar useAltSlotTypesGermanVersion060 = false; // window_devices(should be window_device) and scene_device(should be scene_name)\nif (Number(version.major) >= 0 && Number(version.minor) >= 60 && Number(version.build) >= 10)\n    dynamicInjectSupported = true;\nif (Number(version.major) > 0)\n    dynamicInjectSupported = true;\nif (Number(version.major) === 0  && Number(version.minor) > 60)\n    dynamicInjectSupported = true;\nif (Number(version.major) === 0  && Number(version.minor) === 60 && language === \"de\")   \n    useAltSlotTypesGermanVersion060 = true;\n\n\nif (dynamicInjectSupported === true) {\n    if (msg.deviceList !== undefined) {\n        lightsList = buildETSNamesList(msg.deviceList, 'type', 'lights');\n        blindsList = buildETSNamesList(msg.deviceList, 'type', 'blinds');\n        heatingList = buildETSNamesList(msg.deviceList, 'type', 'heating');\n        scenesList = buildETSNamesList(msg.deviceList, 'type', 'scenes');\n        auxList = buildETSNamesList(msg.deviceList, 'type', 'aux');\n        controlsList = buildETSNamesList(msg.deviceList, 'type', 'controls');\n    \n        \n        if (ETSNamesRoom !== undefined || ETSNamesDevice !== undefined) {\n            msg.inject = true;\n            template1 = \"{\\\"operations\\\": [\";\n            template2 = \"]}\";\n            if (ETSNamesRoom !== undefined) {\n                newRoomList1 = \"[\\\"addFromVanilla\\\",{\\\"house_room\\\":[\";\n                newRoomList2 = ETSNamesRoom;\n                if (lightsList !== undefined) {newRoomList3 = \"]}],\";} else {newRoomList3 = \"]}]\";}\n                tmpNRL = [newRoomList1, newRoomList2, newRoomList3];\n                newRoomList = \"\".concat(...tmpNRL);\n            } else {\n                newRoomlist = \"\";\n            }\n            if (lightsList !== undefined) {\n                newLightsList1 = \"[\\\"addFromVanilla\\\",{\\\"light_device\\\":[\";\n                newLightsList2 = lightsList;\n                if (blindsList !== undefined) {newLightsList3 = \"]}],\";} else {newLightsList3 = \"]}]\";}\n                tmpNRL = [newLightsList1, newLightsList2, newLightsList3];\n                newLightsList = \"\".concat(...tmpNRL);\n            } else {\n                newLightslist = \"\";\n            }\n            if (blindsList !== undefined) {\n                var slot = \"window_device\";\n                if(useAltSlotTypesGermanVersion060 === true)\n                    slot = \"window_devices\";\n                newBlindsList1 = '[\\\"addFromVanilla\\\",{\\\"'+slot+'\\\":[';\n                newBlindsList2 = blindsList;\n                if (heatingList !== undefined) {newBlindsList3 = \"]}],\";} else {newBlindsList3 = \"]}]\";}\n                tmpNRL = [newBlindsList1, newBlindsList2, newBlindsList3];\n                newBlindsList = \"\".concat(...tmpNRL);\n            } else {\n                newBlindsList = \"\";\n            }\n            if (heatingList !== undefined) {\n                newHeatingList1 = \"[\\\"addFromVanilla\\\",{\\\"temperature_device\\\":[\";\n                newHeatingList2 = heatingList;\n                if (scenesList !== undefined) {newHeatingList3 = \"]}],\";} else {newHeatingList3 = \"]}]\";}\n                tmpNRL = [newHeatingList1, newHeatingList2, newHeatingList3];\n                newHeatingList = \"\".concat(...tmpNRL);\n            } else {\n                newHeatingList = \"\";\n            }\n            if (scenesList !== undefined) {\n                var slot = \"scene_name\";\n                if(useAltSlotTypesGermanVersion060 === true)\n                    slot = \"scene_device\";                \n                newScenesList1 = '[\\\"addFromVanilla\\\",{\\\"'+slot+'\\\":[';\n                newScenesList2 = scenesList;\n                newScenesList3 = \"]}]\";\n                tmpNRL = [newScenesList1, newScenesList2, newScenesList3];\n                newScenesList = \"\".concat(...tmpNRL);\n            } else {\n                newScenesList = \"\";\n            }\n            /*if (heatingList !== undefined) {\n                newHeatingList1 = \"[\\\"addFromVanilla\\\",{\\\"device\\\":[\";\n                newHeatingList2 = heatingList;\n                newDeviceList3 = \"]}]\";\n                tmpNDL = [newDeviceList1, newDeviceList2, newDeviceList3];\n                newDeviceList = \"\".concat(...tmpNDL);\n            } else {\n                newDevicelist = \"\";\n            }*/\n            injectionString = [template1, newRoomList, newLightsList, newBlindsList, newHeatingList, newScenesList, template2];\n            tmpInject = \"\".concat(...injectionString);\n            msg.payload = JSON.parse(tmpInject);\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 800,
        "y": 700,
        "wires": [
            [
                "c7a995fc.5d3908",
                "97582b76.d48fe8",
                "93a753e4.cb74f"
            ]
        ]
    },
    {
        "id": "c7a995fc.5d3908",
        "type": "file",
        "z": "69122215.9bd9fc",
        "name": "",
        "filename": "/usr/share/snips/injections.json",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "x": 1090,
        "y": 700,
        "wires": []
    },
    {
        "id": "97582b76.d48fe8",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1000,
        "y": 640,
        "wires": [
            [
                "c859a331.88122"
            ]
        ]
    },
    {
        "id": "c859a331.88122",
        "type": "exec",
        "z": "69122215.9bd9fc",
        "command": "sudo mosquitto_pub -t hermes/injection/perform -f /usr/share/snips/injections.json",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": true,
        "name": "Inject new words",
        "x": 1170,
        "y": 640,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "dc7a9076.6d6ce",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "{\"sessionId\":\"d199f348-766f-4da2-950e-fde2ed67e218\",\"customData\":null,\"siteId\":\"default\",\"input\":\"i want you to turn off the decke in wohnzimmer\",\"asrTokens\":[[{\"value\":\"i\",\"confidence\":1,\"range_start\":0,\"range_end\":1,\"time\":{\"start\":0,\"end\":0.45}},{\"value\":\"want\",\"confidence\":0.9505656,\"range_start\":2,\"range_end\":6,\"time\":{\"start\":0.45,\"end\":0.6959321}},{\"value\":\"you\",\"confidence\":0.97861207,\"range_start\":7,\"range_end\":10,\"time\":{\"start\":0.6959321,\"end\":0.9248669}},{\"value\":\"to\",\"confidence\":0.974402,\"range_start\":11,\"range_end\":13,\"time\":{\"start\":0.9248669,\"end\":1.1053923}},{\"value\":\"turn\",\"confidence\":1,\"range_start\":14,\"range_end\":18,\"time\":{\"start\":1.1053923,\"end\":1.1261268}},{\"value\":\"off\",\"confidence\":0.8267225,\"range_start\":19,\"range_end\":22,\"time\":{\"start\":1.1261268,\"end\":1.9878557}},{\"value\":\"the\",\"confidence\":0.95932883,\"range_start\":23,\"range_end\":26,\"time\":{\"start\":1.9878557,\"end\":2.4716978}},{\"value\":\"decke\",\"confidence\":0.9573682,\"range_start\":27,\"range_end\":32,\"time\":{\"start\":2.4716978,\"end\":3.3464136}},{\"value\":\"in\",\"confidence\":1,\"range_start\":33,\"range_end\":35,\"time\":{\"start\":3.3464136,\"end\":3.5245814}},{\"value\":\"wohnzimmer\",\"confidence\":0.54466087,\"range_start\":36,\"range_end\":46,\"time\":{\"start\":3.8934064,\"end\":5.8799996}}]],\"intent\":{\"intentName\":\"ProKNX:turnOffLights\",\"probability\":0.9891416},\"slots\":[{\"confidence\":0.9573682,\"rawValue\":\"decke\",\"value\":{\"kind\":\"Custom\",\"value\":\"decke\"},\"range\":{\"start\":27,\"end\":32},\"entity\":\"light_device\",\"slotName\":\"light_device\"},{\"confidence\":0.54466087,\"rawValue\":\"wohnzimmer\",\"value\":{\"kind\":\"Custom\",\"value\":\"wohnzimmer\"},\"range\":{\"start\":36,\"end\":46},\"entity\":\"house_room\",\"slotName\":\"room\"}]}",
        "payloadType": "json",
        "repeat": "",
        "crontab": "",
        "once": false,
        "x": 1990,
        "y": 360,
        "wires": [
            [
                "452ddbb4.bf7ed4"
            ]
        ]
    },
    {
        "id": "a2a931d2.bd5d9",
        "type": "ui_form",
        "z": "69122215.9bd9fc",
        "name": "Inject Form",
        "label": "Please enter the name you want to add and select ONE category",
        "group": "f505905.fab087",
        "order": 0,
        "width": "12",
        "height": "21",
        "options": [
            {
                "label": "Add a word to inject",
                "value": "name",
                "type": "text",
                "required": true
            },
            {
                "label": "Room / Zimmer / Pièce",
                "value": "room",
                "type": "checkbox",
                "required": true
            },
            {
                "label": "Light / Licht / Lumière",
                "value": "lights",
                "type": "checkbox",
                "required": true
            },
            {
                "label": "Blinds / Rolladen / Volet",
                "value": "blinds",
                "type": "checkbox",
                "required": true
            },
            {
                "label": "Thermostat",
                "value": "heating",
                "type": "checkbox",
                "required": true
            },
            {
                "label": "Scene / Szene / Scène",
                "value": "scenes",
                "type": "checkbox",
                "required": true
            }
        ],
        "formValue": {
            "name": "",
            "room": false,
            "lights": false,
            "blinds": false,
            "heating": false,
            "scenes": false
        },
        "payload": "",
        "topic": "",
        "x": 300,
        "y": 1480,
        "wires": [
            [
                "5823a1c2.3f89d"
            ]
        ]
    },
    {
        "id": "875ce669.ce10e8",
        "type": "ui_text",
        "z": "69122215.9bd9fc",
        "group": "f505905.fab087",
        "order": 0,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 1270,
        "y": 1520,
        "wires": []
    },
    {
        "id": "5823a1c2.3f89d",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Handle form",
        "func": "injection = msg.payload;\n\nif (injection.room === true) {\n    msg.cat = \"house_room\";\n} else if (injection.lights === true) {\n    msg.cat = \"light_device\";\n} else if (injection.blinds === true) {\n    msg.cat = \"window_device\";\n} else if (injection.heating === true) {\n    msg.cat = \"temperature_device\";\n} else if (injection.scenes === true) {\n    msg.cat = \"scene_name\";\n}\nif (msg.cat !== undefined) {\n    msg.payload = \"{\\\"operations\\\": [ [\\\"add\\\",{\\\"\"+msg.cat+\"\\\":[\\\"\" +injection.name+\"\\\"]}]]}\";\n    msg.message1 = \"Adding \\\"\" + injection.name + \"\\\"! Please wait...\";\n    msg.message2 = \"Your test word has been added ! You are now able to check if it is correctly triggered by SNIPS. Please go on Snips Watch (port 5000) and ask the command you want (using your test word) in order to see if it is correctly understood and parsed in the right category.\";\n} else {\n    msg.error = \"Please select ONE category for your word\";\n    \n}\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 450,
        "y": 1480,
        "wires": [
            [
                "f671ef07.38fc7"
            ]
        ]
    },
    {
        "id": "766efdfc.494704",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 430,
        "y": 700,
        "wires": [
            [
                "f5e3dbf.8396c28"
            ]
        ]
    },
    {
        "id": "dc191c1b.ef0c5",
        "type": "exec",
        "z": "69122215.9bd9fc",
        "command": "sudo dpkg-query --showformat='${Version}' --show snips-asr",
        "addpay": false,
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "oldrc": false,
        "name": "GET snips-asr version",
        "x": 740,
        "y": 1140,
        "wires": [
            [
                "de95b72d.5566a8",
                "bfe1b516.1e4888"
            ],
            [],
            []
        ]
    },
    {
        "id": "f5e3dbf.8396c28",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 615.5555458068848,
        "y": 699.9999752044678,
        "wires": [
            [
                "efb90d1a.4e84a"
            ]
        ]
    },
    {
        "id": "f671ef07.38fc7",
        "type": "switch",
        "z": "69122215.9bd9fc",
        "name": "Error ?",
        "property": "error",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "outputs": 2,
        "x": 590,
        "y": 1480,
        "wires": [
            [
                "93be50f9.4bdd6",
                "9708a3e9.83c36",
                "7edc2de7.0adf84"
            ],
            [
                "ca2ee943.ea2d18"
            ]
        ]
    },
    {
        "id": "ca2ee943.ea2d18",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "error",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 1520,
        "wires": [
            [
                "875ce669.ce10e8",
                "35f153f1.e8f73c"
            ]
        ]
    },
    {
        "id": "93be50f9.4bdd6",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "message1",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 1440,
        "wires": [
            [
                "875ce669.ce10e8",
                "35f153f1.e8f73c"
            ]
        ]
    },
    {
        "id": "dcdbe3ba.e99e3",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "INJECTION OUT",
        "links": [
            "9708a3e9.83c36"
        ],
        "x": 875,
        "y": 640,
        "wires": [
            [
                "c7a995fc.5d3908",
                "97582b76.d48fe8"
            ]
        ]
    },
    {
        "id": "9708a3e9.83c36",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "INJECTION IN",
        "links": [
            "dcdbe3ba.e99e3"
        ],
        "x": 695,
        "y": 1480,
        "wires": []
    },
    {
        "id": "d4801b62.f99858",
        "type": "ui_toast",
        "z": "69122215.9bd9fc",
        "position": "dialog",
        "displayTime": "15",
        "highlight": "",
        "outputs": 1,
        "ok": "OK",
        "cancel": "",
        "topic": "",
        "name": "",
        "x": 1290,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "87a445c5.5f3238",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1020,
        "y": 1480,
        "wires": [
            [
                "d4801b62.f99858"
            ]
        ]
    },
    {
        "id": "7edc2de7.0adf84",
        "type": "change",
        "z": "69122215.9bd9fc",
        "name": "",
        "rules": [
            {
                "t": "move",
                "p": "message2",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 840,
        "y": 1480,
        "wires": [
            [
                "87a445c5.5f3238"
            ]
        ]
    },
    {
        "id": "35f153f1.e8f73c",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 960,
        "y": 1440,
        "wires": [
            [
                "6608f1e5.f5b98"
            ]
        ]
    },
    {
        "id": "6608f1e5.f5b98",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "",
        "func": "msg.payload = \"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 1090,
        "y": 1440,
        "wires": [
            [
                "875ce669.ce10e8"
            ]
        ]
    },
    {
        "id": "bb9b54ee.40af08",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "======================================================================TROUBLESHOOTING UI===============================================================",
        "info": "",
        "x": 790,
        "y": 1380,
        "wires": []
    },
    {
        "id": "39524d00.165174",
        "type": "inject",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "repeat": "",
        "crontab": "",
        "once": true,
        "x": 570,
        "y": 1440,
        "wires": [
            [
                "6608f1e5.f5b98"
            ]
        ]
    },
    {
        "id": "bfe1b516.1e4888",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "payload",
        "x": 930,
        "y": 1180,
        "wires": []
    },
    {
        "id": "8a541951.9cf2e8",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "STARTUP OUT",
        "links": [
            "9c3ebc9.92a644"
        ],
        "x": 1135,
        "y": 360,
        "wires": []
    },
    {
        "id": "92deb384.d852e8",
        "type": "watch",
        "z": "69122215.9bd9fc",
        "name": "",
        "files": "/etc/snips.toml",
        "recursive": "",
        "x": 1790,
        "y": 2400,
        "wires": [
            [
                "93009ebb.ebd548"
            ]
        ]
    },
    {
        "id": "93009ebb.ebd548",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "2",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 1980,
        "y": 2400,
        "wires": [
            [
                "e55c709a.c8143"
            ]
        ]
    },
    {
        "id": "e55c709a.c8143",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2140,
        "y": 2400,
        "wires": [
            [
                "b3acb709.81e868"
            ]
        ]
    },
    {
        "id": "b3acb709.81e868",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "",
        "func": "msg.payload = flow.get(\"msgServerIP\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2270,
        "y": 2400,
        "wires": [
            [
                "f054241a.540dd"
            ]
        ]
    },
    {
        "id": "1ef68e72.5777a2",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "Save SnipsSlient",
        "func": "flow.set(\"snipssilent\", msg.payload); // save for later use\nreturn msg;\n",
        "outputs": 1,
        "noerr": 0,
        "x": 2610,
        "y": 2400,
        "wires": [
            [
                "1aba916a.654f17"
            ]
        ]
    },
    {
        "id": "f054241a.540dd",
        "type": "http request",
        "z": "69122215.9bd9fc",
        "name": "GET snipssilent",
        "method": "GET",
        "ret": "txt",
        "url": "http://{{{payload}}}:3000/snipssilent",
        "tls": "",
        "x": 2420,
        "y": 2400,
        "wires": [
            [
                "1ef68e72.5777a2"
            ]
        ]
    },
    {
        "id": "1aba916a.654f17",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "false",
        "x": 2790,
        "y": 2400,
        "wires": []
    },
    {
        "id": "9c3ebc9.92a644",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "STARTUP IN",
        "links": [
            "8a541951.9cf2e8"
        ],
        "x": 1835,
        "y": 2440,
        "wires": [
            [
                "93009ebb.ebd548"
            ]
        ]
    },
    {
        "id": "79888668.c9509",
        "type": "comment",
        "z": "69122215.9bd9fc",
        "name": "======================================================================SNIPS SETTINGS: SILENTMODE==========================================================",
        "info": "",
        "x": 2370,
        "y": 2360,
        "wires": []
    },
    {
        "id": "93a753e4.cb74f",
        "type": "debug",
        "z": "69122215.9bd9fc",
        "name": "",
        "active": false,
        "console": "false",
        "complete": "false",
        "x": 1030,
        "y": 740,
        "wires": []
    },
    {
        "id": "c8b815a1.bcb198",
        "type": "mqtt out",
        "z": "69122215.9bd9fc",
        "name": "",
        "topic": "hermes/tts/say",
        "qos": "",
        "retain": "",
        "broker": "47ef8ff9.97bcb8",
        "x": 3020,
        "y": 2240,
        "wires": []
    },
    {
        "id": "8736a072.e9a48",
        "type": "function",
        "z": "69122215.9bd9fc",
        "name": "warmup",
        "func": "// the respeaker speaker needs time to get started\nmsg.payload.text = \" \";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 2840,
        "y": 2220,
        "wires": [
            [
                "c8b815a1.bcb198"
            ]
        ]
    },
    {
        "id": "eecc65fd.fcaeb8",
        "type": "delay",
        "z": "69122215.9bd9fc",
        "name": "",
        "pauseType": "delay",
        "timeout": "500",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 2830,
        "y": 2260,
        "wires": [
            [
                "c8b815a1.bcb198"
            ]
        ]
    },
    {
        "id": "2136f97b.401cfe",
        "type": "link in",
        "z": "69122215.9bd9fc",
        "name": "SPEAKER IN",
        "links": [
            "7415437a.7706f4",
            "39633ab4.8b12f6"
        ],
        "x": 2715,
        "y": 2240,
        "wires": [
            [
                "8736a072.e9a48",
                "eecc65fd.fcaeb8"
            ]
        ]
    },
    {
        "id": "39633ab4.8b12f6",
        "type": "link out",
        "z": "69122215.9bd9fc",
        "name": "SPEAKER OUT",
        "links": [
            "2136f97b.401cfe"
        ],
        "x": 2775,
        "y": 2100,
        "wires": []
    },
    {
        "id": "4921ae70.68c63",
        "type": "mqtt-broker",
        "z": "69122215.9bd9fc",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": ""
    },
    {
        "id": "f505905.fab087",
        "type": "ui_group",
        "z": "69122215.9bd9fc",
        "name": "Vocabulary Injection troubleshoot",
        "tab": "2e79e50f.0a05aa",
        "disp": true,
        "width": "12"
    },
    {
        "id": "47ef8ff9.97bcb8",
        "type": "mqtt-broker",
        "z": "69122215.9bd9fc",
        "broker": "localhost",
        "port": "1883",
        "clientid": "",
        "usetls": false,
        "compatmode": true,
        "keepalive": "60",
        "cleansession": true,
        "willTopic": "",
        "willQos": "0",
        "willPayload": "",
        "birthTopic": "",
        "birthQos": "0",
        "birthPayload": ""
    },
    {
        "id": "2e79e50f.0a05aa",
        "type": "ui_tab",
        "z": "69122215.9bd9fc",
        "name": "SNIPS Troubleshoot",
        "icon": "dashboard"
    }
]